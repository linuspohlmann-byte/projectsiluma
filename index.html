<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Polo • Sprachlern‑MVP</title>
  <style>
    :root{
      /* Neutral, freundlich, vertrauenswürdig - Verfeinert */
      --bg: #f8fafc; /* Sehr heller, neutraler Hintergrund */
      --fg: #0f172a; /* Tiefes, aber warmes Grau für Text */
      --muted: #64748b; /* Gedämpfte, professionelle Grautöne */
      --accent: #2563eb; /* Vertrauensbildendes, professionelles Blau */
      --card: #ffffff; /* Reines Weiß für Karten */
      --ok: #059669; /* Ruhiges, motivierendes Grün */
      --warn: #ea580c; /* Warmes, aber nicht aufdringliches Orange */
      --ring: #bfdbfe; /* Sehr sanfte Akzentfarbe */
      
      /* Kinderfreundliche Akzente - Verfeinert */
      --success: #16a34a; /* Erfolg - Ruhiges Grün */
      --reward: #f59e0b; /* Belohnung - Warmes, aber professionelles Gelb */
      --progress: #0891b2; /* Fortschritt - Vertrauensvolles Cyan */
      --border: #e2e8f0; /* Sehr sanfte, neutrale Grenzen */
      --shadow: rgba(15, 23, 42, 0.04); /* Extrem subtile Schatten */
      
      /* Zusätzliche neutrale Farben */
      --surface: #f1f5f9; /* Leichte Oberflächenfarbe */
      --surface-hover: #e2e8f0; /* Hover-Zustand für Oberflächen */
      --text-secondary: #475569; /* Sekundärer Text */
      --text-tertiary: #94a3b8; /* Tertiärer Text */
    }
    html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;-webkit-font-smoothing:antialiased;position:relative;}
    *{box-sizing:border-box}
    html{background:var(--bg) !important;min-height:100vh}
    body{background:var(--bg) !important;min-height:100vh}
    /* Ensure scrollable areas have correct background */
    main, section, article, aside, nav, footer, header{background:var(--bg)}
    /* Override any potential white backgrounds */
    div:not([class*="card"]):not([class*="modal"]):not([class*="tooltip"]):not([class*="level"]):not([class*="onboarding"]){background:transparent}
    /* Ensure the entire viewport has correct background */
    html, body, #root, .app, .container, .wrapper{background:var(--bg) !important}
    .shell{width:80vw;max-width:1400px;margin:0 auto;padding:24px 20px 40px;min-height:100vh;box-sizing:border-box;background:var(--bg)}

    /* 16:9 full-viewport stage wrapper */
    .stage-16x9{position:fixed;inset:0;display:flex;align-items:flex-start;justify-content:center;background:var(--bg);overflow:hidden;}
    .stage-16x9 .stage-inner{position:relative;width:100vw;height:calc(100vw * 9 / 16);display:flex;align-items:stretch;justify-content:center;overflow:auto;margin-top:0}
    @media (max-aspect-ratio: 16/9){
      .stage-16x9 .stage-inner{height:100vh;width:calc(100vh * 16 / 9)}
    }
    /* Ensure app content fills the stage and ignores previous width caps */
    .stage-16x9 .shell{width:100%;max-width:none;min-height:100%;margin:0;padding:24px 20px 24px}
    .stage-16x9 .card.eval, .stage-16x9 #lesson.card{width:100%;max-width:none}
    /* Keep topbar visible when the inner stage scrolls */
    .stage-16x9 .main-navigation{position:sticky;top:0;z-index:500}

    /* Header */
    header{display:flex;gap:16px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 14px;border-radius:16px;background:var(--surface);color:var(--text-secondary);font-size:12px;font-weight:500;letter-spacing:.1px;border:1px solid var(--border);box-shadow:0 1px 2px var(--shadow);transition:all .2s ease}

    /* Top nav */
    /* Main Navigation Tabs */
    .main-navigation {
      background: var(--card);
      border-bottom: 1px solid var(--border);
      margin-bottom: 24px;
      border-radius: 12px 12px 0 0;
      box-shadow: 0 2px 8px var(--shadow);
    }
    
    .nav-tabs {
      display: flex;
      gap: 0;
      padding: 0 8px;
    }
    
    .nav-tab {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 16px 24px;
      border: none;
      background: var(--card);
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      border-radius: 8px 8px 0 0;
      margin: 8px 4px 0 4px;
    }
    
    .nav-tab:hover {
      background: var(--surface);
      color: var(--fg);
      transform: translateY(-1px);
    }
    
    .nav-tab.active {
      background: var(--accent);
      color: white;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
      transform: translateY(-2px);
    }
    
    .nav-tab.active::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid var(--accent);
    }
    
    .tab-icon {
      font-size: 18px;
      transition: transform 0.3s ease;
      color: inherit;
    }
    
    .nav-tab:hover .tab-icon {
      transform: scale(1.1);
    }
    
    .nav-tab.active .tab-icon {
      transform: scale(1.2);
    }
    
    .course-tab:hover .tab-icon {
      transform: scale(1.1);
    }
    
    .course-tab.active .tab-icon {
      transform: scale(1.2);
    }
    
    .user-tab:hover .tab-icon {
      transform: scale(1.1);
    }
    
    .user-tab.active .tab-icon {
      transform: scale(1.2);
    }
    
    .tab-label {
      font-weight: 600;
      letter-spacing: 0.5px;
      color: inherit;
    }
    
    /* Special tab types */
    
    .course-tab {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 16px 24px;
      border: none;
      background: var(--card);
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      border-radius: 8px 8px 0 0;
      margin: 8px 4px 0 4px;
    }
    
    .course-tab:hover {
      background: var(--surface);
      color: var(--fg);
      transform: translateY(-1px);
    }
    
    .course-tab .course-selector {
      display: none;
    }
    
    /* Course tab active state - same as nav-tab */
    .course-tab.active {
      background: var(--accent);
      color: white;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
      transform: translateY(-2px);
    }
    
    .course-tab.active::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid var(--accent);
    }
    
    
    .user-tab {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 16px 24px;
      border: none;
      background: var(--card);
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      border-radius: 8px 8px 0 0;
      margin: 8px 4px 0 4px;
    }
    
    .user-tab:hover {
      background: var(--surface);
      color: var(--fg);
      transform: translateY(-1px);
    }
    
    .user-tab.active {
      background: var(--accent);
      color: white;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
      transform: translateY(-2px);
    }
    
    .user-tab.active::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid var(--accent);
    }
    
    .user-tab .user-info {
      cursor: pointer;
      pointer-events: auto;
    }
    
    .user-tab .login-section {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .user-tab .login-section .user-info {
      cursor: pointer;
      pointer-events: auto;
    }
    
    .user-tab .action-btn {
      padding: 8px 12px;
      font-size: 12px;
      white-space: nowrap;
    }
    
    .user-tab .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 8px;
      border-radius: 6px;
      transition: background-color 0.2s ease;
    }
    
    .user-tab .user-info:hover {
      background: var(--surface-hover);
    }
    
    .user-tab .user-avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    .user-tab .user-details {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    
    .user-tab .user-name {
      font-weight: 600;
      font-size: 12px;
      color: inherit;
    }
    
    .user-tab .user-status {
      font-size: 10px;
      color: inherit;
      opacity: 0.8;
    }
    
    
    /* Logout Tooltip */
    .tooltip {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
      backdrop-filter: blur(8px);
      padding: 8px;
      min-width: 120px;
      position: fixed;
      z-index: 1000;
      transform: none;
      margin: 0;
    }
    
    .tooltip-content {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    /* Login/Register Dropdown */
    .dropdown-menu {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
      backdrop-filter: blur(8px);
      overflow: hidden;
      min-width: 160px;
      position: fixed;
      z-index: 1000;
      transform: none;
      margin: 0;
      padding: 0;
    }
    
    .dropdown-content {
      display: flex;
      flex-direction: column;
      padding: 8px 0;
    }
    
    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: left;
      width: 100%;
    }
    
    .dropdown-item:hover {
      background: var(--surface);
      color: var(--accent);
    }
    
    .dropdown-item:active {
      background: var(--surface-hover);
      transform: translateY(1px);
    }
    
    .dropdown-icon {
      font-size: 16px;
      width: 20px;
      text-align: center;
    }
    
    .dropdown-text {
      flex: 1;
    }
    
    /* Course Cards Styles */
    .courses-container {
      background: transparent;
      border-radius: 0 0 12px 12px;
      padding: 24px;
      box-shadow: none;
      min-height: 400px;
    }
    
    .courses-header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .courses-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text);
      margin: 0 0 16px 0;
      background: linear-gradient(135deg, var(--accent), #1d4ed8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .courses-subtitle {
      font-size: 1.1rem;
      color: var(--text-secondary);
      margin: 0;
      opacity: 0.8;
    }
    
    .courses-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-top: 24px;
      padding: 0 8px;
    }
    
    .course-card {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-sizing: border-box;
      max-width: 100%;
    }
    
    .course-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, var(--accent), #1d4ed8);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .course-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
      border-color: var(--accent);
    }
    
    .course-card:hover::before {
      transform: scaleX(1);
    }
    
    .course-card-header {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
      flex: 1;
    }
    
    .course-flag {
      font-size: 1.5rem;
      margin-right: 10px;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
      flex-shrink: 0;
    }
    
    .course-info {
      flex: 1;
      min-width: 0;
    }
    
    .course-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
      margin: 0 0 4px 0;
      line-height: 1.3;
      word-wrap: break-word;
    }
    
    .course-code {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin: 0;
      font-weight: 500;
    }
    
    
    .course-actions {
      display: flex;
      justify-content: center;
      margin-top: auto;
      padding-top: 16px;
    }
    
    .course-btn {
      padding: 10px 16px;
      border: 2px solid var(--border);
      border-radius: 8px;
      background: var(--surface);
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      width: 100%;
      max-width: 180px;
      box-sizing: border-box;
      font-size: 14px;
    }
    
    .course-btn.primary {
      background: linear-gradient(135deg, var(--accent), #1d4ed8);
      color: white;
      border-color: var(--accent);
    }
    
    .course-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }
    
    .course-btn.primary:hover {
      background: linear-gradient(135deg, #1d4ed8, var(--accent));
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.3);
    }
    
    /* Custom Level Groups Styles */
    
    .custom-level-group {
      position: relative;
    }
    
    .custom-level-group .level-group-thumb {
      background: linear-gradient(135deg, #B91B47, #D91B5A);
      border-left: 4px solid #B91B47;
    }
    
    .custom-level-group .level-group-card {
      border-left: 4px solid #B91B47;
    }
    
    .custom-level-group .level-group-card:hover {
      border-left-color: #D91B5A;
      box-shadow: 0 8px 25px rgba(185, 27, 71, 0.25);
    }
    
    .custom-level-group .level-group-range {
      color: rgba(255, 255, 255, 0.9) !important;
      font-weight: 500;
    }
    
    .custom-level-group .level-group-title {
      color: white !important;
    }
    
    .custom-group-actions {
      position: absolute;
      top: 16px;
      right: 16px;
      display: flex;
      gap: 8px;
      z-index: 10;
    }
    
    .custom-group-actions .btn-icon {
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 6px;
      padding: 6px;
      cursor: pointer;
      transition: background-color 0.2s;
      font-size: 14px;
    }
    
    .custom-group-actions .btn-icon:hover {
      background: rgba(255, 255, 255, 1);
    }
    
    /* Group management quick access in level overview */
    .custom-group-management-quick-access {
      margin: 24px 0;
      padding: 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 2px 8px var(--shadow);
    }
    
    .group-management-header {
      text-align: center;
      margin-bottom: 16px;
    }
    
    .group-management-header h3 {
      margin: 0 0 4px 0;
      font-size: 18px;
      font-weight: 600;
      color: var(--fg);
    }
    
    .group-management-header p {
      margin: 0;
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .group-management-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .group-management-actions .btn-icon {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 16px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    /* Marketplace Styles */
    .marketplace-content {
      padding: 24px;
    }
    
    .marketplace-header {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .marketplace-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--fg);
      margin: 0 0 8px 0;
    }
    
    .marketplace-subtitle {
      font-size: 16px;
      color: var(--text-secondary);
      margin: 0;
    }
    
    
    .marketplace-groups-container {
      min-height: 400px;
    }
    
    .marketplace-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top: 3px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .marketplace-groups-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }
    
    .marketplace-group-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .marketplace-group-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
      border-color: var(--accent);
    }
    
    .marketplace-group-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, var(--accent), #1d4ed8);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .marketplace-group-card:hover::before {
      transform: scaleX(1);
    }
    
    .marketplace-group-header {
      margin-bottom: 16px;
    }
    
    .marketplace-group-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--fg);
      margin: 0 0 8px 0;
      line-height: 1.3;
    }
    
    .marketplace-group-description {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.4;
      margin: 0 0 12px 0;
    }
    
    .marketplace-group-author {
      font-size: 12px;
      color: var(--text-tertiary);
      margin: 0;
    }
    
    .marketplace-group-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding: 12px 0;
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
    }
    
    .marketplace-group-stat {
      text-align: center;
    }
    
    .marketplace-group-stat-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 4px;
    }
    
    .marketplace-group-stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .marketplace-group-actions {
      display: flex;
      gap: 12px;
    }
    
    .marketplace-group-btn {
      flex: 1;
      padding: 10px 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--surface);
      color: var(--fg);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .marketplace-group-btn.primary {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    .marketplace-group-btn:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    .marketplace-group-btn.primary:hover {
      background: var(--accent-dark);
      border-color: var(--accent-dark);
    }
    
    .marketplace-pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      margin-top: 32px;
    }
    
    .page-info {
      font-size: 14px;
      color: var(--text-secondary);
      min-width: 120px;
      text-align: center;
    }
    
    .marketplace-empty {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }
    
    .marketplace-empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }
    
    .marketplace-empty-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--fg);
      margin: 0 0 8px 0;
    }
    
    .marketplace-empty-text {
      font-size: 14px;
      margin: 0;
    }
    
    /* Published status indicator */
    .level-group-action.published {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border: none;
    }
    
    .level-group-action.published:hover {
      background: linear-gradient(135deg, #059669, #047857);
    }
    
    /* Marketplace Preview Modal Styles */
    .marketplace-preview-modal {
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .preview-group-info {
      margin-bottom: 24px;
    }
    
    .preview-group-description {
      margin-bottom: 20px;
    }
    
    .preview-group-description h4 {
      font-size: 16px;
      font-weight: 600;
      color: var(--fg);
      margin: 0 0 8px 0;
    }
    
    .preview-group-description p {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
      margin: 0;
    }
    
    .preview-group-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 16px;
      padding: 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
    }
    
    .preview-meta-item {
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .preview-meta-item strong {
      color: var(--fg);
      font-weight: 600;
    }
    
    .preview-levels h4 {
      font-size: 16px;
      font-weight: 600;
      color: var(--fg);
      margin: 0 0 16px 0;
    }
    
    .preview-levels-list {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--surface);
    }
    
    .preview-level-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
    }
    
    .preview-level-item:last-child {
      border-bottom: none;
    }
    
    .preview-level-number {
      width: 32px;
      height: 32px;
      background: var(--accent);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      flex-shrink: 0;
    }
    
    .preview-level-info {
      flex: 1;
      min-width: 0;
    }
    
    .preview-level-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--fg);
      margin: 0 0 4px 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .preview-level-topic {
      font-size: 12px;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .preview-level-more {
      padding: 12px 16px;
      text-align: center;
      font-size: 14px;
      color: var(--text-secondary);
      font-style: italic;
    }
      font-weight: 500;
    }
    
    .group-management-actions .btn-icon:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }
    
    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    
    .modal-content {
      background: var(--card);
      border-radius: 12px;
      padding: 0;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-header h2 {
      margin: 0;
      font-size: 1.25rem;
      color: var(--text);
    }
    
    .btn-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-secondary);
      padding: 4px;
      border-radius: 4px;
    }
    
    .btn-close:hover {
      background: var(--border);
      color: var(--text);
    }
    
    .modal-body {
      padding: 24px;
    }
    
    .modal-footer {
      padding: 20px 24px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 16px;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .modal-footer-actions {
      display: flex;
      gap: 8px;
      order: 1;
    }
    
    .modal-footer-controls {
      display: flex;
      gap: 12px;
      order: 2;
    }
    
    .btn-danger {
      background: #dc2626;
      color: white;
      border: 1px solid #dc2626;
    }
    
    .btn-danger:hover {
      background: #b91c1c;
      border-color: #b91c1c;
    }
    
    .btn-warning {
      background: #d97706;
      color: white;
      border: 1px solid #d97706;
    }
    
    .btn-warning:hover {
      background: #b45309;
      border-color: #b45309;
    }
    
    /* Responsive modal footer */
    @media (max-width: 768px) {
      .modal-footer {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }
      
      .modal-footer-actions,
      .modal-footer-controls {
        justify-content: center;
        order: unset;
      }
      
      .modal-footer-actions {
        order: 2;
      }
      
      .modal-footer-controls {
        order: 1;
      }
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text);
    }
    
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: 8px;
      background: var(--surface);
      color: var(--text);
      font-size: 14px;
      transition: border-color 0.2s;
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .courses-loading {
      text-align: center;
      padding: 60px 20px;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
    }
    
    /* Custom Level Groups Styles */
    .custom-level-groups-section {
      padding: 24px;
      background: transparent;
      border-radius: 0 0 12px 12px;
      box-shadow: none;
      min-height: 400px;
    }
    
    .library-section {
      margin-bottom: 40px;
    }
    
    .section-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .section-header h2 {
      color: var(--text);
      margin-bottom: 10px;
      font-size: 1.5em;
    }
    
    .section-header p {
      color: var(--text-secondary);
      margin: 0;
    }
    
    .no-custom-groups {
      text-align: center;
      padding: 60px 20px;
      background: var(--surface);
      border-radius: 15px;
      border: 2px dashed var(--border);
    }
    
    .no-custom-groups .icon {
      font-size: 48px;
      margin-bottom: 20px;
    }
    
    .no-custom-groups h3 {
      color: var(--text);
      margin-bottom: 10px;
    }
    
    .no-custom-groups p {
      color: var(--text-secondary);
      margin-bottom: 30px;
    }
    
    
    .custom-groups-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
      margin-top: 24px;
      padding: 0 8px;
    }
    
    .custom-group-card {
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 15px;
      padding: 20px;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .custom-group-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border-color: var(--accent);
    }
    
    .group-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }
    
    .group-header h3 {
      color: var(--text);
      margin: 0;
      font-size: 1.2em;
      flex: 1;
    }
    
    .group-actions {
      display: flex;
      gap: 5px;
    }
    
    .btn-icon {
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
      transition: background-color 0.2s ease;
    }
    
    .btn-icon:hover {
      background: var(--border);
    }
    
    .group-content {
      margin-bottom: 20px;
    }
    
    .group-description {
      color: var(--text-secondary);
      margin-bottom: 15px;
      line-height: 1.5;
    }
    
    .group-meta {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .cefr-badge {
      background: var(--accent);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: 600;
    }
    
    .levels-count {
      background: var(--border);
      color: var(--text);
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
    }
    
    .created-date {
      color: var(--text-secondary);
      font-size: 0.8em;
    }
    
    .group-footer {
      display: flex;
      gap: 10px;
    }
    
    .group-footer .btn {
      flex: 1;
    }
    
    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    
    .modal-content {
      background: var(--surface);
      border-radius: 15px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 2px solid var(--border);
    }
    
    .modal-header h2 {
      color: var(--text);
      margin: 0;
    }
    
    .btn-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-secondary);
      padding: 5px;
      border-radius: 5px;
      transition: all 0.2s ease;
    }
    
    .btn-close:hover {
      background: var(--border);
      color: var(--text);
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .modal-footer {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      padding: 20px;
      border-top: 2px solid var(--border);
    }
    
    /* Form Styles */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    
    .form-group label {
      display: block;
      color: var(--text);
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: 8px;
      background: var(--background);
      color: var(--text);
      font-size: 14px;
      transition: border-color 0.2s ease;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .form-help {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
      display: block;
    }
    
    
    /* Custom Group Details Modal */
    .custom-group-details-modal {
      max-width: 800px;
    }
    
    .group-info {
      margin-bottom: 30px;
    }
    
    .levels-preview h3 {
      color: var(--text);
      margin-bottom: 15px;
    }
    
    .levels-list {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .level-preview {
      display: flex;
      align-items: center;
      padding: 15px;
      background: var(--background);
      border: 2px solid var(--border);
      border-radius: 10px;
      margin-bottom: 10px;
    }
    
    .level-number {
      background: var(--accent);
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      font-weight: 600;
      margin-right: 15px;
      min-width: 80px;
      text-align: center;
    }
    
    .level-info {
      flex: 1;
    }
    
    .level-info h4 {
      color: var(--text);
      margin: 0 0 5px 0;
      font-size: 1em;
    }
    
    .level-info p {
      color: var(--text-secondary);
      margin: 0 0 5px 0;
      font-size: 0.9em;
    }
    
    .items-count {
      color: var(--accent);
      font-size: 0.8em;
      font-weight: 600;
    }
    
    /* Notification Styles */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 1001;
      max-width: 400px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .notification-success {
      background: #10b981;
    }
    
    .notification-error {
      background: #ef4444;
    }
    
    .notification-info {
      background: #3b82f6;
    }
    
    .notification-warning {
      background: #f59e0b;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .custom-groups-grid {
        grid-template-columns: 1fr;
        gap: 16px;
        padding: 0 4px;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .group-footer {
        flex-direction: column;
      }
      
      .modal-content {
        margin: 10px;
        max-height: calc(100vh - 20px);
      }
      
      .level-preview {
        flex-direction: column;
        text-align: center;
      }
      
      .level-number {
        margin-right: 0;
        margin-bottom: 10px;
      }
    }
    
    .loading-spinner {
      border: 4px solid var(--border);
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .courses-error {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }
    
    .error-icon {
      font-size: 3rem;
      margin-bottom: 20px;
    }
    
    .retry-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 16px;
    }
    
    .retry-btn:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
    }
    
    @media (max-width: 768px) {
      .shell{width:95vw;max-width:none}
      .custom-level-groups-section {
        padding: 16px;
      }
      .card.eval{ width:95vw; max-width:none }
      #lesson.card{ width:95vw; max-width:none }
      
      .courses-title {
        font-size: 2rem;
      }
      
      .courses-grid {
        grid-template-columns: 1fr;
        gap: 16px;
        padding: 0 4px;
      }
      
      .course-card {
        padding: 16px;
        min-height: 120px;
      }
      
      .course-actions {
        flex-direction: column;
        margin-top: auto;
        padding-top: 12px;
      }
      
      .course-btn {
        width: 100%;
        max-width: none;
        padding: 10px 20px;
        font-size: 14px;
      }
    }
    
    
    /* Tab Content Areas */
    #tab-content {
      width: 100%;
      position: relative;
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
      width: 100%;
    }
    
    .tab-content.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Library Tab Styles */
    .library-content {
      background: transparent;
      border-radius: 0 0 12px 12px;
      padding: 24px;
      box-shadow: none;
      min-height: 400px;
    }
    
    .global-stat-bar {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      align-items: stretch;
      margin: 16px 0 24px 0;
    }
    
    .global-stat-bar .stat-card {
      flex: 1 1 200px;
      min-width: 160px;
      background: var(--card);
      border-radius: 14px;
      padding: 18px 20px;
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
      border: 1px solid var(--border);
    }
    
    .library-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border);
    }
    
    .library-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--fg);
      margin: 0;
    }
    
    .library-subtitle {
      color: var(--text-secondary);
      font-size: 14px;
      margin-top: 4px;
    }
    
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 16px;
      background: var(--surface);
      border-radius: 8px;
      border: 1px solid var(--border);
    }
    
    .stat-number {
      font-size: 20px;
      font-weight: 700;
      color: var(--accent);
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* Quick Actions Styles */
    .library-quick-actions {
      margin: 24px 0;
      padding: 20px;
      background: var(--surface);
      border-radius: 12px;
      border: 1px solid var(--border);
    }
    
    .quick-actions-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--fg);
      margin: 0 0 16px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .quick-actions-title::before {
      content: '⚡';
      font-size: 20px;
    }
    
    .quick-actions-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }
    
    
    
    .quick-action-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 16px;
      border: 2px solid var(--border);
      border-radius: 12px;
      background: var(--card);
      color: var(--fg);
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      position: relative;
      overflow: hidden;
    }
    
    .quick-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      border-color: var(--accent);
    }
    
    .quick-action-btn.primary {
      background: linear-gradient(135deg, var(--accent), #1d4ed8);
      color: white;
      border-color: var(--accent);
    }
    
    .quick-action-btn.primary:hover {
      background: linear-gradient(135deg, #1d4ed8, var(--accent));
      box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
    }
    
    .quick-action-btn .btn-icon {
      font-size: 32px;
      margin-bottom: 8px;
      transition: transform 0.3s ease;
    }
    
    .quick-action-btn:hover .btn-icon {
      transform: scale(1.1);
    }
    
    .quick-action-btn .btn-label {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .quick-action-btn .btn-description {
      font-size: 12px;
      opacity: 0.8;
      text-align: center;
      line-height: 1.4;
    }
    
    .quick-action-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s ease;
    }
    
    .quick-action-btn:hover::before {
      left: 100%;
    }
    
    /* Settings Tab Styles */
    .settings-content {
      background: transparent;
      border-radius: 0 0 12px 12px;
      padding: 0;
      min-height: 400px;
    }
    
    .settings-header {
      padding: 24px 24px 16px 24px;
      border-bottom: 1px solid var(--border);
      background: var(--surface);
      border-radius: 12px 12px 0 0;
    }
    
    .settings-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--fg);
      margin: 0 0 8px 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .settings-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin: 0;
      line-height: 1.5;
    }
    
    .settings-auto-save-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
      padding: 8px 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      color: var(--text-secondary);
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }
    
    .settings-auto-save-indicator.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .auto-save-icon {
      font-size: 14px;
    }
    
    .auto-save-text {
      font-weight: 500;
    }
    
    .settings-sections {
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 32px;
    }
    
    .settings-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
    }
    
    .settings-section-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--fg);
      margin: 0 0 16px 0;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }
    
    .settings-item {
      margin-bottom: 16px;
    }
    
    .settings-item:last-child {
      margin-bottom: 0;
    }
    
    .settings-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--fg);
      margin-bottom: 8px;
    }
    
    .settings-select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--border);
      border-radius: 8px;
      background: var(--card);
      color: var(--fg);
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .settings-select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .settings-checkbox-label {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      padding: 8px 0;
    }
    
    .settings-checkbox {
      width: 20px;
      height: 20px;
      accent-color: var(--accent);
      cursor: pointer;
    }
    
    .settings-checkbox-text {
      font-size: 14px;
      color: var(--fg);
      user-select: none;
    }
    
    .settings-button {
      padding: 12px 24px;
      border: 2px solid var(--border);
      border-radius: 8px;
      background: var(--card);
      color: var(--fg);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }
    
    .settings-button:hover {
      background: var(--surface);
      border-color: var(--accent);
    }
    
    .settings-button.danger {
      background: #dc2626;
      color: white;
      border-color: #dc2626;
    }
    
    .settings-button.danger:hover {
      background: #b91c1c;
      border-color: #b91c1c;
    }
    
    /* Browse Tab Styles */
    .browse-content {
      background: transparent;
      border-radius: 0 0 12px 12px;
      padding: 24px;
      box-shadow: none;
      min-height: 400px;
    }
    
    .browse-header {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .browse-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--fg);
      margin: 0 0 8px 0;
    }
    
    .browse-subtitle {
      color: var(--text-secondary);
      font-size: 16px;
      margin: 0;
    }
    
    .coming-soon {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 300px;
      text-align: center;
    }
    
    .coming-soon-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.6;
    }
    
    .coming-soon-title {
      font-size: 24px;
      font-weight: 600;
      color: var(--fg);
      margin: 0 0 8px 0;
    }
    
    .coming-soon-text {
      color: var(--text-secondary);
      font-size: 16px;
      margin: 0;
      max-width: 400px;
      line-height: 1.5;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      
      .nav-tabs {
        padding: 0 4px;
      }
      
      .nav-tab {
        padding: 12px 16px;
        font-size: 13px;
        margin: 4px 2px 0 2px;
      }
      
      .tab-icon {
        font-size: 16px;
      }
      
      .library-content,
      .browse-content,
      .courses-container {
        padding: 16px;
      }
      
      
      .global-stat-bar {
        flex-direction: column;
        margin: 12px 0 20px;
      }
      
      .library-header {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
      }
      
      .stat-item {
        padding: 8px 12px;
      }
      
      .quick-actions-buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
        width: 100%;
      }
      
      
      .quick-action-btn {
        padding: 16px 12px;
      }
      
      .quick-action-btn .btn-icon {
        font-size: 28px;
      }
      
      .quick-action-btn .btn-label {
        font-size: 14px;
      }
      
      .quick-action-btn .btn-description {
        font-size: 11px;
      }
    }

    /* Modern Header Styles */
    .modern-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 12px 20px;
      background: var(--card);
      border-bottom: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      position: sticky;
      top: 0;
      z-index: 100;
      flex-wrap: nowrap;
      min-height: 72px;
      width: 80vw;
      max-width: 1400px;
      margin: 0 auto;
      box-sizing: border-box;
    }

    /* Header Columns */
    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
      flex: 1;
      min-width: 0;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
      min-width: 0;
    }

    /* Brand Section */
    .header-brand {
      flex-shrink: 0;
    }

    .brand-logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      font-size: 20px;
      color: var(--accent);
      text-decoration: none;
    }

    .brand-icon {
      font-size: 24px;
      filter: drop-shadow(0 2px 4px rgba(37, 99, 235, 0.2));
    }

    .brand-text {
      background: linear-gradient(135deg, var(--accent), #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Navigation */
    .header-nav {
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1;
      justify-content: center;
      min-width: 0;
    }

    .nav-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 10px 16px;
      background: transparent;
      border: 2px solid transparent;
      border-radius: 10px;
      font-weight: 600;
      font-size: 13px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
    }

    .nav-btn:hover {
      background: var(--surface);
      color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
    }

    .nav-btn.active {
      background: linear-gradient(135deg, var(--accent), #3b82f6);
      color: white;
      box-shadow: 0 4px 16px rgba(37, 99, 235, 0.3);
    }

    .nav-btn.active::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
      border-radius: 12px;
    }

    .nav-icon {
      font-size: 16px;
      filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
    }

    .nav-text {
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    /* Course Info */
    .header-course-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
      min-width: 0;
    }

    .course-selector {
      position: relative;
    }

    .course-select-wrapper {
      position: relative;
    }

    .course-select {
      padding: 10px 32px 10px 14px;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      color: var(--fg);
      cursor: pointer;
      transition: all 0.3s ease;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      min-width: 140px;
      max-width: 180px;
    }

    .course-select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      transform: translateY(-1px);
    }

    .course-select:hover {
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .select-arrow {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 12px;
      pointer-events: none;
      transition: transform 0.3s ease;
    }

    .course-select:focus + .select-arrow {
      transform: translateY(-50%) rotate(180deg);
      color: var(--accent);
    }


    .stat-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-value {
      font-size: 14px;
      font-weight: 700;
      color: var(--accent);
      min-width: 24px;
      text-align: center;
    }

    /* User Section */
    .header-user {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
      min-width: 0;
    }

    .user-section {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent), #3b82f6);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
    }

    .avatar-icon {
      font-size: 18px;
      color: white;
    }

    .user-details {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .user-name {
      font-weight: 600;
      font-size: 14px;
      color: var(--fg);
    }

    .user-status {
      font-size: 12px;
      color: var(--success);
      font-weight: 500;
    }

    .user-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .login-section {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .action-btn {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 10px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .action-btn.primary {
      background: linear-gradient(135deg, var(--accent), #3b82f6);
      color: white;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
    }

    .action-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(37, 99, 235, 0.4);
    }

    .action-btn.secondary {
      background: var(--surface);
      color: var(--text-secondary);
      border-color: var(--border);
    }

    .action-btn.secondary:hover {
      background: var(--card);
      color: var(--accent);
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .btn-icon {
      font-size: 14px;
    }

    .btn-text {
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    /* Responsive Design */
    @media (max-width: 1200px) and (min-width: 769px) {
      .shell{width:90vw;max-width:1200px}
      .custom-level-groups-section {
        padding: 20px;
      }
      .card.eval{ width:90vw; max-width:1200px }
      #lesson.card{ width:90vw; max-width:1200px }
    }
    
    @media (max-width: 1200px) {
      .modern-header {
        gap: 12px;
        padding: 10px 16px;
      }
      
      .header-left {
        gap: 12px;
      }
      
      .header-right {
        gap: 8px;
      }
      
      .progress-stats {
        gap: 10px;
      }
      
      .stat-item {
        padding: 5px 8px;
      }
    }

    @media (max-width: 768px) {
      .modern-header {
        flex-direction: column;
        gap: 12px;
        padding: 12px;
      }
      
      .header-nav {
        order: 2;
        width: 100%;
        justify-content: center;
      }
      
      .header-course-info {
        order: 3;
        width: 100%;
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .header-user {
        order: 1;
        width: 100%;
        justify-content: space-between;
      }
      
      .progress-stats {
        flex-wrap: wrap;
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      .nav-btn {
        padding: 8px 12px;
        font-size: 12px;
      }
      
      .nav-text {
        display: none;
      }
      
      .stat-label {
        display: none;
      }
      
      .btn-text {
        display: none;
      }
      
      .course-select {
        min-width: 120px;
        max-width: 140px;
        font-size: 12px;
      }
      
      .action-btn {
        padding: 5px 8px;
        font-size: 10px;
      }
    }
    .brand{display:flex;align-items:center;gap:10px}
    .brand-mark{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg, var(--accent), #1d4ed8);box-shadow:0 2px 8px rgba(37, 99, 235, 0.12);border:1px solid rgba(255,255,255,0.2)}
    .brand-name{font-weight:700;letter-spacing:.2px;font-size:18px;color:var(--fg);text-shadow:none}
    .nav{display:flex;gap:8px;align-items:center}
    .nav button {
      background: var(--surface);
      color: var(--text-secondary);
      border: 1px solid var(--border);
      padding: 10px 18px;
      border-radius: 10px;
      font-weight: 500;
      transition: all .2s ease;
      box-shadow: 0 1px 2px var(--shadow);
    }
    .nav button.active {
      background: var(--accent);
      color: white;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.2);
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    /* Progress */
    .bar{flex:1;height:8px;background:var(--surface);border-radius:999px;overflow:hidden;position:relative;border:1px solid var(--border)}
    .bar>i{display:block;height:100%;width:0;background:var(--accent);transition:width .4s ease;border-radius:999px}

    /* Controls */
    button,select{background:var(--accent);color:white;border:0;border-radius:10px;padding:12px 20px;font-weight:500;cursor:pointer;box-shadow:0 2px 8px rgba(37, 99, 235, 0.15);transition:all .2s ease}
    button.secondary, select{background:var(--surface);color:var(--text-secondary);border:1px solid transparent;box-shadow:0 2px 4px rgba(0,0,0,0.05)}
    button:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(37, 99, 235, 0.2)}
    button:active{transform:translateY(0)}
    button:focus-visible, select:focus-visible, textarea:focus-visible, input:focus-visible{outline:none;box-shadow:0 0 0 3px rgba(37, 99, 235, 0.2)}

    /* Highlight secondary buttons on hover (tooltip, menus, etc.) */
    button.secondary:hover{ background:var(--accent); color:white; box-shadow:0 2px 8px rgba(37, 99, 235, 0.2); border-color:var(--accent); transform:translateY(-1px) }

    /* Unified nav button hover: all .nav button except .active */
    .nav button:hover:not(.active) {
      background: var(--surface-hover);
      color:var(--fg);
      box-shadow:0 2px 4px var(--shadow);
      border-color:var(--border);
      transform:translateY(-1px);
    }

    /* Remove old .nav button:hover rule (if present) and .nav button.active:hover (not needed) */
    section.card{background:var(--card);border-radius:12px;padding:24px 28px;margin-top:24px;box-shadow:0 2px 8px var(--shadow), 0 1px 2px var(--shadow);border:1px solid var(--border)}

    /* Text */
    .sentence {
      font-size:24px;
      line-height:1.7;
      background:var(--surface);
      border-radius:12px;
      padding:24px 28px;
      margin-top:20px;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      flex-wrap: wrap;
      border: none;
      box-shadow: none;
    }

    .sentence-row {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      width: 100%;
      border: none !important;
      box-shadow: none !important;
      background: transparent !important;
      text-align: center;
    }
    .word{padding:4px 8px;border-radius:6px;cursor:pointer;transition:all .2s ease;border:1px solid transparent}
    .word:hover{background:var(--accent);color:white;transform:translateY(-1px);box-shadow:0 1px 4px rgba(37, 99, 235, 0.15)}

    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .grow{flex:1}

    /* Inputs - cleaner design with reduced borders */
    textarea, input{width:100%;background:var(--card);color:var(--fg);border:1px solid transparent;border-radius:10px;padding:14px 18px;transition:all .2s ease;box-shadow:0 2px 4px rgba(0,0,0,0.05)}
    textarea{font-size:16px; line-height:1.5; resize:vertical; min-height:40px}
    textarea:focus, input:focus{border-color:var(--accent);box-shadow:0 4px 8px rgba(0,0,0,0.1), 0 0 0 3px rgba(37, 99, 235, 0.1)}

    /* Ensure lesson textarea shows full placeholder on load */
    #user-translation{
      min-height: 72px;
      overflow: auto;
      line-height: 1.4;
      display: block;
    }
    #user-translation::placeholder{ white-space: normal; }
    #progress-block{margin-bottom:12px}

    /* Table */
    table{width:100%;border-collapse:separate;border-spacing:0 6px}
    th{position:sticky;top:0;background:var(--surface);color:var(--text-secondary);font-size:12px;text-transform:uppercase;letter-spacing:.3px;padding:14px 18px;border-bottom:1px solid var(--border)}
    td{background:var(--card);border-bottom:0;padding:18px;border:1px solid var(--border);border-radius:8px}
    tr:hover td{background:var(--surface);transform:translateY(-1px);box-shadow:0 1px 4px var(--shadow)}

    /* Words toolbar */
    .wbar{display:flex;align-items:center;gap:8px;justify-content:flex-end;margin-bottom:8px}
    .menu{position:relative}
    .menu-btn{background:var(--surface);color:var(--text-secondary);border:1px solid var(--border);border-radius:8px;padding:8px 14px;font-weight:500;cursor:pointer;box-shadow:0 1px 2px var(--shadow)}
    .menu-pop{position:absolute;right:0;top:100%;margin-top:8px;min-width:300px;background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:0 4px 16px var(--shadow);padding:20px;display:none;z-index:100}
    .menu-pop .row{margin:10px 0}
    .menu-pop label{font-size:12px;color:var(--text-secondary);font-weight:500}
    .sep{height:1px;background:var(--border);margin:16px 0}

    /* Pager */
    .pager{display:flex;align-items:center;gap:8px;justify-content:flex-end;margin-top:8px}
    .pager .pill{min-width:120px;justify-content:center}

    /* Tooltip */
    #tooltip{position:fixed;display:none;background:var(--card);border:1px solid var(--border);border-radius:12px;min-width:360px;max-width:420px;box-shadow:0 8px 24px var(--shadow);z-index:200;backdrop-filter:blur(8px)}
    #tooltip header{display:flex;justify-content:space-between;align-items:center;padding:18px 22px;border-bottom:1px solid var(--border)}
    #tooltip header h4{margin:0;font-size:14px;letter-spacing:.1px;color:var(--fg);font-weight:600}
    #tooltip .x{cursor:pointer;background:var(--surface);border-radius:6px;padding:4px 12px;font-weight:500;color:var(--text-secondary);border:1px solid var(--border)}
    .icon-btn{display:inline-flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:8px;background:var(--surface);color:var(--text-secondary);border:1px solid var(--border);padding:0;cursor:pointer;box-shadow:0 1px 2px var(--shadow)}
    .icon-btn:hover{background:var(--accent);color:white;transform:translateY(-1px)}
    #tooltip .body{padding:18px 22px;display:grid;gap:14px}
    #tooltip textarea{min-height:auto; height:auto; overflow:hidden; resize:vertical}
    #tooltip input, #tooltip textarea{
      background:var(--card);
      color:var(--fg);
      border:1px solid var(--border);
      border-radius:10px;
      padding:14px 18px;
      width: calc(100% - 36px);
    }
    #tooltip audio{width:220px;height:36px}

    /* Modern Level Tooltip */
    #level-tip{ 
      position:fixed; display:none; background:var(--card); border:1px solid var(--border); 
      border-radius:16px; min-width:320px; max-width:450px; box-shadow:0 12px 32px var(--shadow); 
      z-index:300; backdrop-filter:blur(12px); overflow:visible;
    }
    #level-tip::before{ 
      content:''; position:absolute; top:0; left:0; right:0; height:4px; 
      background:linear-gradient(90deg,var(--accent),#1d4ed8); 
    }
    #level-tip header{ 
      position:relative; padding:20px 24px 16px; border-bottom:1px solid var(--border); 
      display:flex; align-items:center; justify-content:space-between; 
    }
    #level-tip #lt-title{ 
      font-size:18px; font-weight:700; color:var(--fg); margin:0; 
    }
    #level-tip #lt-close{ 
      position:absolute; top:16px; right:16px; width:32px; height:32px; 
      border-radius:8px; background:var(--surface); color:var(--text-secondary); 
      border:1px solid var(--border); display:flex; align-items:center; justify-content:center; 
      cursor:pointer; font-size:18px; font-weight:500; transition:all .2s ease;
    }
    #level-tip #lt-close:hover{ 
      background:var(--accent); color:white; border-color:transparent; 
    }
    #level-tip .body{ 
      padding:20px 24px; 
    }
    #level-tip .level-info{ 
      display:grid; gap:12px; margin-bottom:16px; 
    }
    #level-tip .info-row{ 
      display:flex; align-items:center; justify-content:space-between; 
    }
    #level-tip .info-label{ 
      font-size:14px; color:var(--text-secondary); font-weight:500; 
    }
    #level-tip .info-value{ 
      font-size:14px; color:var(--fg); font-weight:600; 
    }
    #level-tip .level-stats{ 
      display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; margin:12px 0; 
    }
    #level-tip .stat-item{ 
      text-align:center; padding:12px; background:var(--surface); border-radius:8px; border:1px solid var(--border); 
    }
    #level-tip .stat-number{ 
      font-size:18px; font-weight:700; color:var(--fg); margin-bottom:4px; 
    }
    #level-tip .stat-label{ 
      font-size:11px; color:var(--text-secondary); font-weight:600; text-transform:uppercase; letter-spacing:.5px; 
    }
    
    /* Tooltip field styling */
    .tooltip-field {
      margin-bottom: 16px;
    }
    
    .tooltip-field label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 14px;
    }
    
    .tooltip-text-field {
      padding: 10px 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      color: var(--fg);
      min-height: 20px;
      line-height: 1.4;
      word-wrap: break-word;
    }
    
    .tooltip-text-field:empty::before {
      content: "–";
      color: var(--text-tertiary);
      font-style: italic;
    }
    
    .tooltip-editable {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      background: var(--card);
      color: var(--fg);
      box-sizing: border-box;
      font-family: inherit;
      resize: vertical;
      min-height: 40px;
    }
    
    .tooltip-editable:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .tooltip-editable::placeholder {
      color: var(--text-tertiary);
      font-style: italic;
    }

    /* Responsive tooltip adjustments */
    @media (max-width: 768px) {
      #tooltip, #level-tip {
        min-width: 280px;
        max-width: 90vw;
        margin: 0 auto;
      }

      #tooltip .body, #level-tip .body {
        padding: 16px 20px;
      }

      #tooltip header, #level-tip header {
        padding: 16px 20px 12px;
      }
    }

    /* Field stacks */
    .field{display:flex;flex-direction:column;gap:6px}

    /* Instruction hint - OLD STYLE (deprecated) */
    .hint{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 18px;color:var(--text-secondary);font-size:14px;box-shadow:0 1px 2px var(--shadow)}
    
    /* NEW: Simplified Instruction Panel */
    .instruction-panel {
      background: transparent;
      border: none;
      border-radius: 0;
      padding: 16px 0;
      margin: 0 0 8px 0;
      color: var(--text-primary);
      font-size: 16px;
      font-weight: 500;
      line-height: 1.5;
      box-shadow: none;
      position: relative;
      overflow: visible;
      animation: instructionSlideIn 0.6s ease-out;
    }
    
    .instruction-panel::before {
      display: none;
    }
    
    .instruction-panel .instruction-icon {
      display: inline-block;
      font-size: 20px;
      margin-right: 12px;
      vertical-align: middle;
      animation: instructionIconPulse 2s ease-in-out infinite;
    }
    
    .instruction-panel .instruction-text {
      display: inline-block;
      vertical-align: middle;
      position: relative;
      z-index: 1;
    }
    
    .instruction-panel .instruction-highlight {
      background: rgba(37, 99, 235, 0.1);
      padding: 2px 8px;
      border-radius: 6px;
      font-weight: 600;
    }
    
    /* Task-specific instruction styling - unified to MC color */
    .instruction-panel.mc-task,
    .instruction-panel.sb-task,
    .instruction-panel.translate-task {
      color: var(--accent);
    }
    
    /* Animations */
    @keyframes instructionSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes instructionIconPulse {
      0%, 100% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.1);
        opacity: 0.8;
      }
    }
    
    /* Mobile responsive for instruction panel */
    @media (max-width: 768px) {
      .instruction-panel {
        padding: 20px 24px;
        font-size: 15px;
        margin: 0 0 20px 0;
        border-radius: 12px;
      }
      
      .instruction-panel .instruction-icon {
        font-size: 18px;
        margin-right: 10px;
      }
    }
    
    /* Enhanced Feedback Styling */
    #result {
      margin-top: 20px;
      padding: 0;
      background: transparent;
      border: none;
      box-shadow: none;
      transition: all 0.3s ease;
    }
    
    /* Success Feedback */
    #result.success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      padding: 20px 24px;
      border-radius: 16px;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.25);
      border: 2px solid rgba(255, 255, 255, 0.2);
      animation: successPulse 0.6s ease-out;
      position: relative;
      overflow: hidden;
    }
    
    #result.success::before {
      content: '✅';
      font-size: 24px;
      margin-right: 12px;
      animation: checkmarkBounce 0.8s ease-out;
    }
    
    #result.success i {
      font-style: normal;
      font-weight: 500;
      background: rgba(255, 255, 255, 0.15);
      padding: 4px 12px;
      border-radius: 20px;
      margin-left: 8px;
      display: inline-block;
    }
    
    /* Error Feedback */
    #result.error {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      padding: 20px 24px;
      border-radius: 16px;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.25);
      border: 2px solid rgba(255, 255, 255, 0.2);
      animation: errorShake 0.6s ease-out;
      position: relative;
      overflow: hidden;
    }
    
    #result.error::before {
      content: '❌';
      font-size: 24px;
      margin-right: 12px;
      animation: errorBounce 0.8s ease-out;
    }
    
    #result.error i {
      font-style: normal;
      font-weight: 500;
      background: rgba(255, 255, 255, 0.15);
      padding: 4px 12px;
      border-radius: 20px;
      margin-left: 8px;
      display: inline-block;
    }
    
    /* Animations */
    @keyframes successPulse {
      0% { 
        transform: scale(0.9); 
        opacity: 0; 
      }
      50% { 
        transform: scale(1.05); 
      }
      100% { 
        transform: scale(1); 
        opacity: 1; 
      }
    }
    
    @keyframes checkmarkBounce {
      0% { transform: scale(0) rotate(0deg); }
      50% { transform: scale(1.2) rotate(10deg); }
      100% { transform: scale(1) rotate(0deg); }
    }
    
    @keyframes errorShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    @keyframes errorBounce {
      0% { transform: scale(0) rotate(0deg); }
      50% { transform: scale(1.2) rotate(-10deg); }
      100% { transform: scale(1) rotate(0deg); }
    }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
      #result.success, #result.error {
        padding: 16px 20px;
        font-size: 15px;
        margin-top: 16px;
      }
      
      #result.success::before, #result.error::before {
        font-size: 20px;
        margin-right: 8px;
      }
    }

    /* Modern Levels Grid */
    .levels{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin-top:24px;padding:0 8px}
    .level-groups-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:24px;margin-top:24px;padding:0 8px}
    
    /* Remove background from section containing level groups */
    .library-content section {
      background: transparent;
    }
    .level-group-card{position:relative;display:flex;flex-direction:column;overflow:hidden;border-radius:18px;background:var(--card);border:1px solid var(--border);box-shadow:0 12px 30px rgba(15,23,42,0.08);cursor:pointer;transition:transform .25s ease, box-shadow .25s ease,border-color .25s ease}
    .level-group-card:hover{transform:translateY(-4px);box-shadow:0 20px 40px rgba(15,23,42,0.12);border-color:rgba(37,99,235,0.35)}
    .level-group-card.active{border-color:rgba(37,99,235,0.6);box-shadow:0 18px 38px rgba(37,99,235,0.2)}
    .level-group-card:focus{outline:2px solid rgba(37,99,235,0.55);outline-offset:4px}
    .level-group-thumb{position:relative;padding:28px;background:linear-gradient(135deg,rgba(37,99,235,0.2),rgba(56,189,248,0.25));display:flex;flex-direction:column;justify-content:flex-end;color:var(--fg);min-height:140px}
    .level-group-chip{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;background:rgba(37,99,235,0.15);color:var(--accent);font-weight:600;font-size:13px;letter-spacing:.3px}
    .level-group-title{margin-top:18px;font-size:22px;font-weight:700;line-height:1.25}
    .level-group-range{margin-top:6px;font-size:14px;color:var(--text-secondary);letter-spacing:.4px;text-transform:uppercase}
    .level-group-meta{display:flex;justify-content:space-between;gap:16px;padding:18px 24px;background:var(--surface);border-top:1px solid var(--border)}
    .level-group-stat{display:flex;flex-direction:column;gap:6px;font-size:13px;color:var(--text-secondary)}
    .level-group-stat-value{font-size:20px;font-weight:700;color:var(--fg)}
    .level-group-progress{width:100%;height:6px;border-radius:999px;background:rgba(148,163,184,0.25);overflow:hidden;margin-top:16px}
    .level-group-progress-bar{height:100%;background:linear-gradient(135deg,var(--accent),#38bdf8);width:0%;transition:width .4s ease}
    .level-group-footer{padding:18px 24px;display:flex;justify-content:flex-end;background:var(--card)}
    .level-group-action{display:inline-flex;align-items:center;gap:8px;font-weight:600;color:var(--accent);font-size:14px}
    .levels-group-header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-top:24px;margin-bottom:8px;padding:0 8px}
    .levels-group-title-wrap{display:flex;flex-direction:column;gap:6px}
    .levels-group-heading{font-size:20px;font-weight:700;color:var(--fg);display:flex;align-items:center;gap:10px}
    .levels-group-subtitle{font-size:13px;color:var(--text-secondary)}
    .levels-group-back{display:inline-flex;align-items:center;gap:8px;font-size:14px;font-weight:600;color:var(--accent);cursor:pointer;padding:6px 10px;border-radius:999px;background:rgba(37,99,235,0.08);border:1px solid rgba(37,99,235,0.2);transition:background .2s ease,border-color .2s ease}
    .levels-group-back:hover{background:rgba(37,99,235,0.16);border-color:rgba(37,99,235,0.35)}
    .level-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:0;position:relative;cursor:pointer;transition:all .3s ease;box-shadow:0 2px 8px var(--shadow);overflow:hidden;min-height:380px;height:auto;perspective:1000px}
    
    .level-card-inner{position:relative;width:100%;height:100%;text-align:center;transition:transform .6s;transform-style:preserve-3d}
    
    .level-card.flipped .level-card-inner{transform:rotateY(180deg)}
    
    .level-card-front, .level-card-back{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:16px;overflow:hidden}
    
    .level-card-back{transform:rotateY(180deg);background:var(--card);border:1px solid var(--border)}
    
    .level-card-back-content{display:flex;flex-direction:column;height:100%;padding:16px;gap:12px}
    
    .level-card-back-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    
    .level-card-back-title{font-size:18px;font-weight:600;color:var(--text);margin:0}
    
    .level-card-back-close{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:4px 8px;font-weight:500;color:var(--text-secondary);cursor:pointer;font-size:14px}
    
    .level-card-back-close:hover{background:var(--border);color:var(--text)}
    
    .level-card-back-info{display:flex;flex-direction:column;gap:12px}
    
    .level-card-back-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border)}
    
    .level-card-back-row:last-child{border-bottom:none}
    
    .level-card-back-label{font-size:14px;color:var(--text-secondary);font-weight:500}
    
    .level-card-back-value{font-size:14px;color:var(--text);font-weight:600}
    
    /* Familiarity Overview Styles */
    .familiarity-overview-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 12px;
      text-align: center;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--accent);
    }
    
    .familiarity-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .familiarity-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 8px;
      background: var(--surface);
      border-radius: 6px;
      border: 1px solid var(--border);
      transition: all 0.2s ease;
    }
    
    .familiarity-item:hover {
      background: var(--border);
      transform: translateX(1px);
    }
    
    .familiarity-symbol {
      font-size: 14px;
      min-width: 20px;
      text-align: center;
    }
    
    .familiarity-label {
      flex: 1;
      font-size: 11px;
      color: var(--text);
      font-weight: 500;
    }
    
    .familiarity-count {
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 600;
      min-width: 20px;
      text-align: right;
      background: var(--card);
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid var(--border);
    }
    
    /* Button Highlighting Styles */
    .level-btn.highlighted-blue {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8) !important;
      color: white !important;
      border: 2px solid #1e40af !important;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;
      transform: translateY(-1px);
    }
    
    .level-btn.highlighted-green {
      background: linear-gradient(135deg, #10b981, #059669) !important;
      color: white !important;
      border: 2px solid #047857 !important;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3) !important;
      transform: translateY(-1px);
    }
    
    .level-btn.highlighted-gold {
      background: linear-gradient(135deg, #f59e0b, #d97706) !important;
      color: white !important;
      border: 2px solid #b45309 !important;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3) !important;
      transform: translateY(-1px);
    }
    
    .level-btn.highlighted-blue:hover,
    .level-btn.highlighted-green:hover,
    .level-btn.highlighted-gold:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2) !important;
    }
    
    .level-card-content{display:flex;flex-direction:column;height:100%;padding:20px}
    
    .level-card-info{flex:1;display:flex;flex-direction:column;gap:8px}
    
    /* Special spacing for milestone levels (alphabet, 10, 20, 30, 40, 50) - only these specific levels */
    .level-card[data-level="alphabet"],
    .level-card[data-level="10"],
    .level-card[data-level="20"],
    .level-card[data-level="30"],
    .level-card[data-level="40"],
    .level-card[data-level="50"] {
      grid-column: 1 / -1; /* Span the full width of the grid */
      width: 100%;
      min-width: 100%;
      max-width: 100%;
      /* Ensure it doesn't overflow the container */
      box-sizing: border-box;
    }
    
    /* All other levels (1-9, 11-19, 21-29, 31-39, 41-49) use normal grid layout */
    .level-card:not([data-level="alphabet"]):not([data-level="10"]):not([data-level="20"]):not([data-level="30"]):not([data-level="40"]):not([data-level="50"]) {
      grid-column: auto;
      width: auto;
      min-width: auto;
      max-width: none;
    }
    .level-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:var(--border);transition:all .3s ease}
    .level-card.unlocked::before{background:linear-gradient(90deg,var(--accent),#1d4ed8)}
    .level-card.done::before{background:linear-gradient(90deg,var(--success),#047857)}
    .level-card.gold::before{background:linear-gradient(90deg,#ffd700,#ffb000,#ff8c00);box-shadow:0 0 8px rgba(255,215,0,0.3)}
    .level-card.locked{opacity:.4;cursor:not-allowed;filter:saturate(60%)}
    .level-card.gold{box-shadow:0 4px 16px rgba(255,215,0,0.2),0 0 0 1px rgba(255,215,0,0.1)}
    .level-card:hover:not(.locked){transform:translateY(-4px);box-shadow:0 8px 24px var(--shadow)}
    .level-card.gold:hover:not(.locked){transform:translateY(-4px);box-shadow:0 8px 24px rgba(255,215,0,0.3),0 0 0 1px rgba(255,215,0,0.2)}
    
    /* Level Card Content */
    .level-number{width:60px;height:60px;min-width:60px;min-height:60px;border-radius:50%;background:var(--surface);color:var(--text-secondary);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;border:3px solid var(--border);margin-bottom:16px;align-self:center;transition:all .3s ease;flex-shrink:0}
    .level-card.unlocked .level-number{background:linear-gradient(135deg,var(--accent),#1d4ed8);color:white;border:none}
    .level-card.done .level-number{background:linear-gradient(135deg,var(--success),#047857);color:white;border:none}
    .level-card.gold .level-number{background:linear-gradient(135deg,#ffd700,#ffb000,#ff8c00);color:#8b4513;border:none;box-shadow:0 2px 8px rgba(255,215,0,0.4),inset 0 1px 0 rgba(255,255,255,0.3)}
    
    /* Special styling for alphabet level */
    .level-card[data-level="alphabet"] .level-number {
      background: linear-gradient(135deg, var(--accent), #1d4ed8);
      color: white;
      border: none;
      font-size: 32px;
    }
    
    /* Word Statistics on Front of Card */
    .level-word-stats {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 12px;
      padding: 12px;
      background: var(--surface);
      border-radius: 12px;
      border: 1px solid var(--border);
    }
    
    .level-word-stats-main {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    
    .level-word-stats-left {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
    }
    
    .level-word-stats-right {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-shrink: 0;
    }
    
    .level-words-count, .level-learned-count {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
    }
    
    /* Completion Circle Styles */
    .level-completion-circle {
      position: relative;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .completion-circle-svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }
    
    .completion-circle-bg {
      fill: none;
      stroke: var(--border);
      stroke-width: 2;
    }
    
    .completion-circle-fill {
      fill: none;
      stroke-width: 3;
      stroke-linecap: round;
      transition: all 0.6s ease;
    }
    
    .completion-circle-fill.low {
      stroke: #ef4444; /* Red for low progress */
    }
    
    .completion-circle-fill.medium {
      stroke: #f59e0b; /* Orange for medium progress */
    }
    
    .completion-circle-fill.high {
      stroke: #10b981; /* Green for high progress */
    }
    
    .completion-circle-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 11px;
      font-weight: 700;
      color: var(--text);
      text-align: center;
      line-height: 1;
    }
    
    .words-icon, .learned-icon {
      font-size: 16px;
      opacity: 0.9;
    }
    
    .words-text, .learned-text {
      color: var(--text);
      min-width: 20px;
      text-align: right;
    }
    
    .level-progress-bar {
      width: 100%;
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 4px;
    }
    
    .level-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), #1d4ed8);
      border-radius: 3px;
      transition: width 0.6s ease;
      width: 0%;
    }
    
    .level-card.done .level-progress-fill {
      background: linear-gradient(90deg, var(--success), #047857);
    }
    
    .level-card.gold .level-progress-fill {
      background: linear-gradient(90deg, #ffd700, #ffb000);
      box-shadow: 0 0 6px rgba(255, 215, 0, 0.4);
    }
    .level-status{display:flex;align-items:center;gap:6px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;justify-content:center}
    .level-status.unlocked{color:var(--accent)}
    .level-status.done{color:var(--success)}
    .level-status.gold{color:#ffd700;text-shadow:0 0 4px rgba(255,215,0,0.5)}
    .level-status.locked{color:var(--text-tertiary)}
    
    .level-title{font-size:18px;font-weight:700;color:var(--fg);margin-bottom:8px;line-height:1.3;text-align:center}
    .level-theme{font-size:14px;color:var(--text-secondary);margin-bottom:16px;line-height:1.4;text-align:center;font-weight:500}
    
    .level-progress{display:flex;align-items:center;gap:12px;margin-top:16px}
    .progress-bar{flex:1;height:6px;background:var(--surface);border-radius:3px;overflow:hidden}
    .progress-fill{height:100%;background:var(--accent);border-radius:3px;transition:width .6s ease}
    .level-card.done .progress-fill{background:var(--success)}
    .level-card.gold .progress-fill{background:linear-gradient(90deg,#ffd700,#ffb000);box-shadow:0 0 6px rgba(255,215,0,0.4)}
    .progress-text{font-size:12px;font-weight:600;color:var(--text-secondary);min-width:40px;text-align:right}
    
    /* Level Actions */
    .level-actions{display:flex;gap:8px;margin-top:16px;opacity:1;transition:opacity .2s ease;justify-content:center}
    .level-card:hover .level-actions{opacity:1}
    .level-btn{flex:1;padding:8px 12px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--text-secondary);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s ease}
    .level-btn:hover{background:var(--accent);color:white;border-color:transparent}
    .level-btn.primary{background:var(--accent);color:white;border-color:transparent}
    .level-btn.primary:hover{background:#1d4ed8;box-shadow:0 4px 12px rgba(37, 99, 235, 0.3)}
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .levels{grid-template-columns:1fr;gap:16px;padding:0 4px}
      .level-groups-grid{grid-template-columns:1fr;padding:0 4px}
      .level-group-card{border-radius:16px}
      .level-group-thumb{min-height:120px;padding:22px}
      .level-group-meta{flex-direction:column;align-items:flex-start;gap:12px;padding:16px 20px}
      .level-group-footer{padding:16px 20px}
      .levels-group-header{flex-direction:column;align-items:flex-start;padding:0 4px}
      .stats-actions{flex-direction:column}
      .level-card-content{padding:16px}
      .level-number{width:50px;height:50px;min-width:50px;min-height:50px;font-size:18px;margin-bottom:12px;flex-shrink:0}
      .level-title{font-size:16px}
      .level-actions{flex-direction:column;gap:6px}
      .level-btn{font-size:11px;padding:6px 10px}
      
      /* Milestone levels on mobile - full width */
      .level-card[data-level="alphabet"],
      .level-card[data-level="10"],
      .level-card[data-level="20"],
      .level-card[data-level="30"],
      .level-card[data-level="40"],
      .level-card[data-level="50"] {
        grid-column: span 1;
        min-width: auto;
        max-width: none;
      }
      
      /* All other levels on mobile use normal single column */
      .level-card:not([data-level="alphabet"]):not([data-level="10"]):not([data-level="20"]):not([data-level="30"]):not([data-level="40"]):not([data-level="50"]) {
        grid-column: span 1;
        width: auto;
        min-width: auto;
        max-width: none;
      }
    }
    
    /* Medium screens - milestone levels still span full width */
    @media (max-width: 1200px) and (min-width: 769px) {
      .level-card[data-level="alphabet"],
      .level-card[data-level="10"],
      .level-card[data-level="20"],
      .level-card[data-level="30"],
      .level-card[data-level="40"],
      .level-card[data-level="50"] {
        grid-column: 1 / -1; /* Still span the full width */
        width: 100%;
        min-width: 100%;
        max-width: 100%;
      }
      
      /* All other levels on medium screens use normal grid layout */
      .level-card:not([data-level="alphabet"]):not([data-level="10"]):not([data-level="20"]):not([data-level="30"]):not([data-level="40"]):not([data-level="50"]) {
        grid-column: auto;
        width: auto;
        min-width: auto;
        max-width: none;
      }
    }

    /* Modern Course Configuration */
    .course-config{
      background: linear-gradient(135deg, var(--surface) 0%, var(--card) 100%);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 4px 16px var(--shadow);
    }

    /* Compact Words Interface */
    .words-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 16px;
    }

    .toolbar-left {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .toolbar-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .search-box {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 4px;
    }

    .search-input {
      border: none;
      background: transparent;
      padding: 8px 12px;
      font-size: 14px;
      color: var(--fg);
      min-width: 200px;
    }

    .search-input:focus {
      outline: none;
    }

    .filter-select, .sort-select {
      border: none;
      background: transparent;
      padding: 8px;
      font-size: 12px;
      color: var(--text-secondary);
      cursor: pointer;
    }

    .sort-controls {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .sort-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .sort-btn:hover {
      background: var(--card);
    }

    .menu-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .menu-btn:hover {
      background: var(--card);
    }

    .menu-pop {
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      min-width: 200px;
      box-shadow: 0 4px 12px var(--shadow);
      z-index: 1000;
      display: none;
    }

    .menu-section {
      margin-bottom: 16px;
    }

    .menu-section:last-child {
      margin-bottom: 0;
    }

    .menu-section h4 {
      font-size: 14px;
      font-weight: 600;
      color: var(--fg);
      margin-bottom: 8px;
    }

    .column-toggles {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .column-toggles label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      cursor: pointer;
    }

    .delete-btn {
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .delete-btn:disabled {
      background: var(--text-tertiary);
      cursor: not-allowed;
    }

    .words-table-container {
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .compact-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .compact-table th {
      background: var(--surface);
      padding: 12px 8px;
      text-align: left;
      font-weight: 600;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
    }

    .compact-table td {
      padding: 12px 8px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
    }

    .compact-table tbody tr:hover {
      background: var(--surface);
    }

    .select-col { width: 40px; }
    .word-col { width: 150px; }
    .translation-col { width: 200px; }
    .familiarity-col { width: 100px; }
    .example-col { width: 250px; }
    .actions-col { width: 80px; }

    .words-pager {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 0;
      border-top: 1px solid var(--border);
      margin-top: 16px;
    }

    .pager-info {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .per-page-select {
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 4px 8px;
      font-size: 12px;
      background: var(--surface);
      color: var(--fg);
    }

    .pager-controls {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .pager-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .pager-btn:hover {
      background: var(--card);
    }

    .pager-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* New Words tab (learning view) */
    .words-learning {
      background: transparent;
      padding: 24px;
      border-radius: 0 0 12px 12px;
    }

    .words-learning-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 24px;
      margin-bottom: 24px;
    }

    .words-learning-title {
      font-size: 28px;
      margin: 0;
      color: var(--fg);
    }

    .words-learning-subtitle {
      margin: 8px 0 0;
      color: var(--text-secondary);
      max-width: 520px;
    }

    .words-learning-controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 24px;
      align-items: center;
    }

    .words-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .words-filter-chip {
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text-secondary);
      border-radius: 20px;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .words-filter-chip:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .words-filter-chip.active {
      background: var(--accent);
      color: white;
      border-color: transparent;
      box-shadow: 0 10px 20px rgba(37, 99, 235, 0.20);
    }

    .words-search-sort {
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
    }

    .words-search {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 8px 16px;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.05);
    }

    .words-search-icon {
      font-size: 16px;
      color: var(--text-secondary);
    }

    .words-search-input {
      border: none;
      outline: none;
      font-size: 14px;
      min-width: 220px;
      background: transparent;
      color: var(--fg);
    }

    .words-sort {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .words-sort-select {
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: 10px;
      padding: 8px 12px;
      font-size: 13px;
      color: var(--fg);
    }

    .words-learning-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      padding: 32px 0;
      color: var(--text-secondary);
    }

    .words-learning-message {
      display: none;
      padding: 32px 0;
    }

    .message-card {
      background: var(--card);
      border-radius: 16px;
      padding: 32px;
      border: 1px solid var(--border);
      max-width: 520px;
      margin: 0 auto;
      text-align: center;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
    }

    .message-card h3 {
      margin: 0 0 8px;
      font-size: 22px;
      color: var(--fg);
    }

    .message-card p {
      margin: 0 0 16px;
      color: var(--text-secondary);
    }

    .primary-btn {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(37, 99, 235, 0.18);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .primary-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 28px rgba(37, 99, 235, 0.22);
    }

    .message-card .primary-btn {
      padding: 10px 20px;
    }

    .words-learning-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 16px;
    }

    .word-learning-card {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 12px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .word-learning-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 32px rgba(37, 99, 235, 0.15);
    }

    .word-card-header {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: flex-start;
    }

    .word-card-title {
      font-size: 20px;
      margin: 0;
      color: var(--fg);
      word-break: break-word;
    }

    .word-card-translation {
      margin: 4px 0 0;
      color: var(--text-secondary);
    }

    .familiarity-badge {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .familiarity-0 { background: rgba(210, 229, 253, 0.5); color: #1d4ed8; }
    .familiarity-1 { background: rgba(232, 220, 255, 0.6); color: #7c3aed; }
    .familiarity-2 { background: rgba(251, 216, 197, 0.6); color: #ea580c; }
    .familiarity-3 { background: rgba(217, 249, 157, 0.6); color: #4d7c0f; }
    .familiarity-4 { background: rgba(191, 219, 254, 0.6); color: #1d4ed8; }

    .word-card-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      color: var(--text-secondary);
      font-size: 12px;
    }

    .word-card-chip {
      background: var(--surface);
      border-radius: 10px;
      padding: 4px 8px;
    }

    .word-card-example {
      margin: 0;
      font-size: 14px;
      color: var(--fg);
    }

    .word-card-example-native {
      margin: 0;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .word-card-footer {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 12px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .word-progress {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .progress-pill {
      background: var(--surface);
      border-radius: 12px;
      padding: 4px 8px;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .word-last-reviewed {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    @media (max-width: 768px) {
      .words-learning {
        padding: 16px;
      }
      .words-learning-header {
        gap: 16px;
      }
      .words-search-input {
        min-width: 160px;
      }
      .words-learning-grid {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      }
    }

    /* Familiarity badges */
    .familiarity-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .familiarity-badge.unknown { background: var(--text-tertiary); color: white; }
    .familiarity-badge.seen { background: #6b7280; color: white; }
    .familiarity-badge.learning { background: #f59e0b; color: white; }
    .familiarity-badge.familiar { background: #10b981; color: white; }
    .familiarity-badge.strong { background: #3b82f6; color: white; }
    .familiarity-badge.memorized { background: #8b5cf6; color: white; }

    /* Action buttons in table */
    .action-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin: 0 2px;
    }

    .action-btn:hover {
      background: var(--card);
      border-color: var(--accent);
    }
    
    .config-header{
      text-align: center;
      margin-bottom: 24px;
    }
    
    .config-title{
      font-size: 24px;
      font-weight: 700;
      color: var(--fg);
      margin: 0 0 8px 0;
      letter-spacing: -0.5px;
    }
    
    .config-subtitle{
      font-size: 14px;
      color: var(--text-secondary);
      margin: 0;
      font-weight: 500;
    }
    
    .config-grid{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }
    
    .config-item{
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .config-label{
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .config-icon{
      font-size: 18px;
      width: 24px;
      text-align: center;
    }
    
    .config-label label{
      font-size: 14px;
      font-weight: 600;
      color: var(--fg);
      margin: 0;
    }
    
    .select-wrapper{
      position: relative;
    }
    
    .modern-select{
      width: 100%;
      padding: 14px 40px 14px 16px;
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 15px;
      font-weight: 500;
      color: var(--fg);
      cursor: pointer;
      transition: all 0.3s ease;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }
    
    .modern-select:focus{
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      transform: translateY(-1px);
    }
    
    .modern-select:hover{
      border-color: var(--accent);
      transform: translateY(-1px);
    }
    
    .select-arrow{
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 12px;
      pointer-events: none;
      transition: transform 0.3s ease;
    }
    
    .select-wrapper:hover .select-arrow{
      color: var(--accent);
    }
    
    .modern-select:focus + .select-arrow{
      transform: translateY(-50%) rotate(180deg);
      color: var(--accent);
    }
    
    /* Enhanced Course Configuration */
    .enhanced-course-config {
      padding: 16px;
      background: linear-gradient(135deg, var(--surface) 0%, var(--card) 100%);
      border-bottom: 1px solid var(--border);
      margin-bottom: 0;
    }
    
    .config-navigation,
    .config-settings,
    .config-stats {
      margin-bottom: 16px;
    }
    
    .config-navigation:last-child,
    .config-settings:last-child,
    .config-stats:last-child {
      margin-bottom: 0;
    }
    
    
    .section-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 15px;
      font-weight: 600;
      color: var(--fg);
      margin-bottom: 12px;
    }
    
    .section-icon {
      font-size: 18px;
    }
    
    .nav-buttons {
      display: flex;
      gap: 12px;
    }
    
    .config-nav-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .config-nav-btn:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
    }
    
    .config-nav-btn .nav-icon {
      font-size: 16px;
    }
    
    .settings-row {
      display: flex;
      gap: 16px;
      align-items: end;
    }
    
    .config-item {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
    }
    
    .config-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .config-icon {
      font-size: 14px;
      filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }

    .stats-actions {
      display: flex;
      gap: 12px;
      margin-top: 18px;
    }

    .stats-action-btn {
      flex: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--surface);
      font-weight: 600;
      font-size: 14px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .stats-action-btn .btn-icon {
      font-size: 18px;
    }

    .stats-action-btn.primary {
      background: var(--accent);
      color: white;
      border-color: transparent;
      box-shadow: 0 8px 18px rgba(37, 99, 235, 0.25);
    }

    .stats-action-btn:hover {
      background: var(--accent);
      color: white;
      border-color: transparent;
      box-shadow: 0 12px 32px rgba(37, 99, 235, 0.28);
      transform: translateY(-1px);
    }

    .stats-action-btn:disabled {
      cursor: not-allowed;
      opacity: 0.6;
      background: var(--surface-hover);
      color: var(--text-tertiary);
      border-color: var(--border);
      box-shadow: none;
      transform: none;
    }

    .stats-action-btn.primary:disabled {
      background: rgba(37, 99, 235, 0.35);
      color: rgba(255,255,255,0.85);
      border-color: transparent;
    }
    
    .stat-card {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow);
      border-color: var(--accent);
    }
    
    .clickable-stat {
      cursor: pointer;
      position: relative;
    }
    
    .clickable-stat:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow);
      border-color: var(--accent);
    }
    
    .stat-action {
      position: absolute;
      bottom: 6px;
      right: 6px;
      font-size: 9px;
      color: var(--text-tertiary);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .clickable-stat:hover .stat-action {
      opacity: 0;
    }
    
    .stat-card .stat-icon {
      font-size: 20px;
      flex-shrink: 0;
    }
    
    .stat-content {
      flex: 1;
    }
    
    .stat-content .stat-label {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 2px;
    }
    
    .stat-content .stat-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--fg);
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .enhanced-course-config {
        padding: 16px;
      }
      
      .settings-row {
        flex-direction: column;
        gap: 16px;
        align-items: stretch;
      }
      
      .config-item {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
      
      .config-label {
        flex-shrink: 0;
      }
      
      .nav-buttons {
        flex-direction: column;
        gap: 8px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .stat-card {
        padding: 12px;
        min-width: 120px;
      }
    }

    /* Levels layout expansion */
    #levels-card{ overflow: visible; }
    .levels{ padding: 8px 0 28px; }

    /* Status chip colors */
  .pill.ok{background:var(--surface);color:var(--ok);border-color:var(--ok)}
  .pill.warn{background:var(--surface);color:var(--warn);border-color:var(--warn)}
  .pill.error{background:var(--surface);color:var(--warn);border-color:var(--warn)}
    .pulse{animation:pulse 1.2s ease 2}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(37, 99, 235, 0.3)}70%{box-shadow:0 0 0 10px rgba(37, 99, 235, 0)}100%{box-shadow:0 0 0 0 rgba(37, 99, 235, 0)}}

  /* Onboarding Styles */
  .onboarding-modal {
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    z-index: 10000;
  }

  .onboarding-container {
    max-width: 600px;
    width: 90vw;
    max-height: 80vh;
    background: var(--card);
    border-radius: 24px;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    overflow: hidden;
    animation: onboardingSlideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  @keyframes onboardingSlideIn {
    from {
      opacity: 0;
      transform: scale(0.95) translateY(20px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  .onboarding-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px 32px 16px;
    border-bottom: 1px solid var(--border);
  }

  .onboarding-progress {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .progress-bar {
    width: 120px;
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--accent));
    border-radius: 3px;
    transition: width 0.3s ease;
    width: 25%;
  }

  .progress-text {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-secondary);
  }

  .onboarding-skip {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 14px;
    cursor: pointer;
    padding: 8px 16px;
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .onboarding-skip:hover {
    background: var(--surface-hover);
    color: var(--fg);
  }

  .onboarding-content {
    padding: 32px;
    min-height: 400px;
    position: relative;
  }

  .onboarding-step {
    display: none;
    text-align: center;
    animation: stepFadeIn 0.3s ease;
  }

  .onboarding-step.active {
    display: block;
  }

  @keyframes stepFadeIn {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .onboarding-icon {
    font-size: 64px;
    margin-bottom: 24px;
    animation: iconBounce 0.6s ease;
  }

  @keyframes iconBounce {
    0%, 20%, 50%, 80%, 100% {
      transform: translateY(0);
    }
    40% {
      transform: translateY(-10px);
    }
    60% {
      transform: translateY(-5px);
    }
  }

  .onboarding-step h2 {
    font-size: 28px;
    font-weight: 700;
    color: var(--fg);
    margin-bottom: 12px;
    line-height: 1.2;
  }

  .onboarding-step p {
    font-size: 16px;
    color: var(--text-secondary);
    margin-bottom: 32px;
    line-height: 1.5;
  }

  .onboarding-field {
    margin-bottom: 24px;
  }

  .onboarding-fields {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 32px;
  }

  .onboarding-field label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    color: var(--fg);
    margin-bottom: 8px;
    text-align: left;
  }

  .onboarding-select {
    width: 100%;
    padding: 16px;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: var(--surface);
    color: var(--text);
    font-size: 16px;
    transition: all 0.2s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 12px center;
    background-repeat: no-repeat;
    background-size: 16px;
    padding-right: 40px;
  }

  .onboarding-select:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }

  .onboarding-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 32px;
  }

  .onboarding-option {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    border: 2px solid var(--border);
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: var(--surface);
  }

  .onboarding-option:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  }

  .onboarding-option.selected {
    border-color: var(--accent);
    background: rgba(37, 99, 235, 0.05);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }

  .option-icon {
    font-size: 32px;
    flex-shrink: 0;
  }

  .option-content {
    text-align: left;
    flex: 1;
  }

  .option-content h4 {
    font-size: 16px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 4px;
  }

  .option-content p {
    font-size: 14px;
    color: var(--text-secondary);
    margin: 0;
    line-height: 1.4;
  }

  .onboarding-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 32px;
  }

  .onboarding-actions button {
    padding: 16px 32px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 120px;
  }

  .onboarding-actions .primary {
    background: linear-gradient(135deg, var(--accent), #1d4ed8);
    color: white;
    box-shadow: 0 4px 14px rgba(37, 99, 235, 0.3);
  }

  .onboarding-actions .primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
  }

  .onboarding-actions .secondary {
    background: var(--surface);
    color: var(--fg);
    border: 2px solid var(--border);
  }

  .onboarding-actions .secondary:hover {
    background: var(--surface-hover);
    border-color: var(--text-secondary);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .onboarding-container {
      width: 95vw;
      max-height: 90vh;
    }

    .onboarding-header {
      padding: 20px 24px 16px;
    }

    .onboarding-content {
      padding: 24px;
    }

    .onboarding-step h2 {
      font-size: 24px;
    }

    .onboarding-fields {
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .onboarding-options {
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .onboarding-option {
      padding: 16px;
    }

    .onboarding-actions {
      flex-direction: column;
    }

    .onboarding-actions button {
      width: 100%;
    }
  }

    /* Evaluation redesign */
    .card.eval{ width:80vw; max-width:1400px; margin-left:auto; margin-right:auto; padding:36px 32px; background: var(--card); border:1px solid var(--border); backdrop-filter: blur(8px); box-shadow:0 4px 16px var(--shadow); }
    .center-col{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px }
    .center-row{ display:flex; align-items:center; justify-content:center; gap:10px; flex-wrap:wrap }
    .eval-title{ font-size:28px; font-weight:700; letter-spacing:.1px; margin:0; text-align:center; color:var(--fg) }
    .eval-subtitle{ font-size:14px; font-weight:500; letter-spacing:.2px; margin:12px 0 2px; color:var(--text-secondary); text-transform:uppercase; text-align:center }

    /* Progress ring */
    .ring{ width:100px; height:100px; position:relative }
    .ring svg{ width:100px; height:100px; transform:rotate(-90deg) }
    .ring .bg{ stroke:var(--surface); stroke-width:8; fill:none }
    .ring .fg{ stroke: url(#gradScore); stroke-width:8; stroke-linecap:round; fill:none; transition: stroke-dashoffset .6s ease }
    .ring .val{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-weight:600; font-size:14px; color:var(--fg) }

    /* Reveal animation */
    .reveal{ animation:reveal .35s ease; }
    @keyframes reveal{ from{ opacity:0; transform: translateY(6px) } to{ opacity:1; transform: translateY(0) } }

    /* Eval status grid */
    .status-grid{ display:grid; grid-template-columns:repeat(6, minmax(0,1fr)); gap:22px; max-width:760px; margin:24px auto 0; }
    .status-grid .cell{ text-align:center }
    .status-grid .lbl{ font-size:13px; font-weight:700; color:var(--text-secondary); letter-spacing:.2px }
    .status-grid .num{ font-size:15px; font-weight:900; margin-top:6px }

    /* Rating buttons */
    .rating-btn {
      transition: all 0.2s ease;
      border: 2px solid var(--border) !important;
      background: var(--card-bg) !important;
      color: var(--text) !important;
    }
    .rating-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow);
      border-color: var(--primary) !important;
    }
    .rating-btn.active {
      background: var(--primary) !important;
      color: white !important;
      border-color: var(--primary) !important;
    }
    .rating-btn.thumbs-up.active {
      background: #10b981 !important;
      border-color: #10b981 !important;
    }
    .rating-btn.thumbs-down.active {
      background: #ef4444 !important;
      border-color: #ef4444 !important;
    }
    .rating-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Word familiarity highlights - no borders */
    #sentence-wrap .word{ transition: box-shadow .15s ease }
    #sentence-wrap .word.fam-0{ 
      background: rgba(255, 193, 7, 0.15) !important; 
      border: none !important; 
      box-shadow: 0 0 0 1px rgba(255, 193, 7, 0.2); 
      border-radius: 8px; 
    }
    #sentence-wrap .word.fam-1,
    #sentence-wrap .word.fam-2{ 
      background: rgba(255, 152, 0, 0.1) !important; 
      border: none !important; 
      box-shadow: 0 0 0 1px rgba(255, 152, 0, 0.15); 
      border-radius: 8px; 
    }
    
    /* MC and SB familiarity highlights */
    #mc-options button.fam-0,
    .sb-options button.fam-0,
    .sb-area .sb-chip.fam-0 {
      background: rgba(255, 193, 7, 0.15) !important;
      border: 1px solid rgba(255, 193, 7, 0.3) !important;
      box-shadow: 0 0 0 1px rgba(255, 193, 7, 0.2);
    }
    
    #mc-options button.fam-1,
    #mc-options button.fam-2,
    .sb-options button.fam-1,
    .sb-options button.fam-2,
    .sb-area .sb-chip.fam-1,
    .sb-area .sb-chip.fam-2 {
      background: rgba(255, 152, 0, 0.1) !important;
      border: 1px solid rgba(255, 152, 0, 0.2) !important;
      box-shadow: 0 0 0 1px rgba(255, 152, 0, 0.15);
    }

    /* Debug */
    #dbg{position:fixed;left:8px;bottom:8px;font:12px/1.2 system-ui;background:var(--surface);color:var(--text-secondary);padding:6px 8px;border:1px solid var(--border);border-radius:8px;z-index:2000}

    /* Loader */
    #loader{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:var(--bg);backdrop-filter:blur(4px) saturate(120%);z-index:1500}
    .loader-box{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px 20px;display:flex;gap:14px;align-items:center;box-shadow:0 18px 42px var(--shadow)}
    .spinner{width:28px;height:28px;border-radius:50%;border:3px solid var(--border);border-top-color:var(--accent);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .loader-text{font-weight:700;letter-spacing:.2px;color:var(--fg)}
    /* ---- Nav state hard override (wins over global button styles) ---- */
    .nav button {
      background:var(--surface) !important;
      color:var(--fg) !important;
      border:1px solid var(--border) !important;
      box-shadow: inset 0 0 0 1px var(--border) !important;
    }
    .nav button.active {
      background: var(--accent) !important;
      color:white !important;
      border-color: transparent !important;
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.2) !important;
    }
    .nav button:hover:not(.active) {
      background: var(--accent) !important;
      color:white !important;
      border-color: transparent !important;
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.25) !important;
    }

    .lang-wrap select { height:34px; padding:6px 10px }
    .lang-wrap select{
      width: 56px;              /* compact width for flag */
      text-align: center;       /* center the flag */
      text-align-last: center;  /* some browsers */
      padding: 6px 8px;         /* slightly tighter */
      font-size: 16px;          /* readable flag size */
      line-height: 1;           /* avoid vertical clipping */
    }

    /* MC option button states - enhanced visibility */
    #lesson #mc-options button.active,
    #lesson .mc-options-grid button.active{
      background: var(--accent) !important;
      color: white !important;
      border-color: transparent !important;
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4) !important;
      transform: translateY(-2px) !important;
      font-weight: 600 !important;
    }
    
    /* MC option hover states */
    #lesson #mc-options button:hover:not(.active),
    #lesson .mc-options-grid button:hover:not(.active){
      background: var(--surface-hover) !important;
      color: var(--text-primary) !important;
      transform: translateY(-1px) !important;
    }
    
    /* Check Button States - Enhanced Visibility */
    #lesson #check {
      transition: all 0.3s ease;
    }
    
    #lesson #check.ready {
      background: var(--accent) !important;
      color: white !important;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3) !important;
      transform: translateY(-1px) !important;
    }
    
    #lesson #check.continue {
      background: #10b981 !important;
      color: white !important;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3) !important;
      transform: translateY(-1px) !important;
    }
    
    #lesson #check:disabled {
      background: var(--surface) !important;
      color: var(--text-secondary) !important;
      opacity: 0.6 !important;
      transform: none !important;
      box-shadow: none !important;
      cursor: not-allowed !important;
    }
    #lesson #mc-options button.ok{
      background: var(--ok);
      color:white;
      border-color: transparent
    }
    #lesson #mc-options button.bad{
      background:var(--warn);
      color:#fff;
      border-color: transparent
    }

    .lang-wrap option{ font-size:16px; }

    /* Sentence Builder layout */
    .sb-wrap{ display:grid; grid-template-columns:1fr; gap:12px; margin-top:10px; justify-items:center }
    @media (min-width: 720px){ .sb-wrap{ grid-template-columns:1fr; } }
    .sb-area{ min-height:44px; padding:8px; border-radius:10px; background:var(--surface); display:flex; gap:8px; flex-wrap:wrap; justify-content:center }
    .sb-options{ padding:8px; border-radius:10px; background:var(--surface); display:flex; gap:8px; flex-wrap:wrap; justify-content:center }
    .sb-chip{ cursor:grab }
    .sb-chip:active{ cursor:grabbing }

    #sentence-wrap { display:flex; flex-direction:column; align-items:center; text-align:center; width:100%; max-width:100%; box-sizing:border-box; overflow:hidden; flex:1 }
    #lesson .sentence { width:100%; max-width:100%; justify-content:center; box-sizing:border-box; overflow:hidden }
    /* MC Options with labels - similar to Sentence Builder */
    .mc-options-container{ display:flex; flex-direction:column; align-items:center; gap:12px; width:100%; max-width:100%; box-sizing:border-box; flex:1 }
    .mc-label{ font-size:16px; font-weight:600; color:var(--text-primary); text-align:center; margin-bottom:8px }
    .mc-options-grid{ display:flex; justify-content:center; align-items:center; flex-wrap:wrap; gap:8px; width:100%; max-width:100%; box-sizing:border-box }
    
    /* Translate Labels - similar to Sentence Builder */
    .translate-label{ font-size:16px; font-weight:600; color:var(--text-primary); text-align:left; margin-bottom:8px; padding-left:4px }
    
    /* Legacy support */
    #mc-options{ display:flex; justify-content:center; align-items:center; flex-wrap:wrap; gap:8px; width:100%; max-width:100%; box-sizing:border-box; flex:1 }
    .sb-wrap{ display:grid; grid-template-columns:1fr; gap:12px; margin-top:10px; justify-items:center; width:100%; max-width:100%; box-sizing:border-box; flex:1 }
    .sb-area{ min-height:44px; padding:8px; border-radius:10px; background:var(--surface); display:flex; gap:8px; flex-wrap:wrap; justify-content:center; width:100%; max-width:100%; box-sizing:border-box; flex:1 }
    .sb-options{ padding:8px; border-radius:10px; background:var(--surface); display:flex; gap:8px; flex-wrap:wrap; justify-content:center; width:100%; max-width:100%; box-sizing:border-box; flex:1 }
    #lesson-replay {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      font-size: 400%; /* make icon 4x larger */
      width: 120px;
      height: 120px;
    }

    /* zentrierter, großer Audio-Button - cleaner design */
    .replay-row{ display:flex; justify-content:center; align-items:center; width:100%; margin-top:8px }
    #lesson .icon-btn#lesson-replay{
      width:60px !important;
      height:60px !important;
      font-size:200% !important;
      display:inline-flex;
      justify-content:center;
      align-items:center;
    }

    /* Translate-Wörter wie SB/MC-Chips */
    #sentence-wrap .word{
      display:inline-block;
      padding:6px 10px;
      margin:2px 4px;
      border-radius:10px;
      background:var(--surface);
      color:var(--fg);
      border:1px solid var(--border);
    }
    #sentence-wrap .word:hover{
      background:var(--accent);
      color:white;
      border-color:transparent;
    }

    /* ---- Layout polish v1 ---- */
    #lesson.card{ width:80vw; max-width:1400px; margin-left:auto; margin-right:auto; box-sizing:border-box; overflow:hidden }
    :root{ --s1:8px; --s2:12px; --s3:16px }
    #sentence-wrap{ gap: var(--s2) }

    /* Sentence und Audio */
    .sentence{ line-height:1.5 !important }
    .replay-row{ display:flex; justify-content:center; align-items:center; width:100%; margin-top:10px }
    #lesson .icon-btn#lesson-replay{
      width:48px !important; height:48px !important; font-size:24px !important;
      display:inline-flex; justify-content:center; align-items:center
    }

    /* Einheitliche Chips (Translate, MC, SB) - no borders */
    #sentence-wrap .word,
    #mc-options button,
    .sb-options button,
    .sb-area .sb-chip{
      min-height:34px; padding:6px 10px; border-radius:10px; font-size:16px; line-height:1.2;
      border:none; 
      box-shadow:0 2px 4px rgba(0,0,0,0.05);
      transition:all 0.2s ease;
    }
    
    /* MC and SB buttons - cleaner hover states */
    #mc-options button:hover,
    .sb-options button:hover,
    .sb-area .sb-chip:hover{
      box-shadow:0 4px 8px rgba(0,0,0,0.15);
      transform:translateY(-1px);
    }
    /* Translate-Wörter im Chip-Look - no borders */
    #sentence-wrap .word{ background:var(--surface); border:none; box-shadow:0 2px 4px rgba(0,0,0,0.05) }
    #sentence-wrap .word:hover{ background:var(--accent); color:white; border:none; box-shadow:0 4px 8px rgba(0,0,0,0.15) }

    /* SB-Zonen - reduced visual clutter */
    .sb-area, .sb-options{ justify-content:center; gap:8px; padding:10px; background:var(--surface); border-radius:10px; border:none; box-shadow:none }
    .sb-area .placeholder{ border:2px dashed var(--border); border-radius:10px; width:90px; height:34px }

    /* Lesbarkeit */
    .hint{ background:var(--surface); border-color:var(--border) !important; color:var(--text-secondary); box-shadow:none }

    /* Sticky Actions */
    #lesson .row.actions{
      position:sticky; bottom:12px;
      background:transparent;
      padding:12px 0 8px 0; 
      margin:16px 0 0 0;
      z-index:10;
      backdrop-filter:blur(4px);
    }

    /* Responsive */
    @media (max-width:560px){
      #lesson.card{ max-width:100%; margin:0; padding:16px; }
      #lesson .icon-btn#lesson-replay{ width:40px !important; height:40px !important; font-size:20px !important }
    }
    
    /* Ensure all lesson elements respect container width */
    #lesson textarea, #lesson input, #lesson .row {
      max-width: 100%;
      box-sizing: border-box;
    }

    /* --- SB layout upgrade --- */
    .sb-section{ width:100%; display:flex; flex-direction:column; align-items:center; gap:8px; margin-top:12px }
    .sb-label{ font-size:16px; font-weight:600; color:var(--text-primary); text-align:center; margin-bottom:8px }
    .sb-area{ position:relative }
    .sb-area.highlight{ outline:2px solid var(--accent); outline-offset:2px }
    .sb-placeholder{ width:90px; height:34px; border:2px dashed var(--border); border-radius:10px; display:inline-flex; align-items:center; justify-content:center; margin:4px }
    @media (max-width:560px){ .sb-placeholder{ width:72px; height:32px } }
    
    /* Elegant Level Locked Message */
    .level-locked-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--card);
      border: 2px solid var(--warn);
      border-radius: 16px;
      padding: 32px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      z-index: 2000;
      text-align: center;
      animation: levelLockedSlideIn 0.3s ease-out;
    }
    
    .level-locked-message .icon {
      font-size: 48px;
      margin-bottom: 16px;
      display: block;
    }
    
    .level-locked-message .title {
      font-size: 20px;
      font-weight: 700;
      color: var(--fg);
      margin-bottom: 12px;
    }
    
    .level-locked-message .message {
      font-size: 16px;
      color: var(--text-secondary);
      margin-bottom: 24px;
      line-height: 1.5;
    }
    
    .level-locked-message .progress-info {
      background: var(--surface);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
      border: 1px solid var(--border);
    }
    
    .level-locked-message .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
      margin: 8px 0;
    }
    
    .level-locked-message .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--warn), #f59e0b);
      border-radius: 4px;
      transition: width 0.3s ease;
    }
    
    .level-locked-message .progress-text {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
    }
    
    .level-locked-message .actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    
    .level-locked-message .btn {
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
    }
    
    .level-locked-message .btn-primary {
      background: var(--accent);
      color: white;
    }
    
    .level-locked-message .btn-primary:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
    }
    
    .level-locked-message .btn-secondary {
      background: var(--surface);
      color: var(--text-secondary);
      border: 1px solid var(--border);
    }
    
    .level-locked-message .btn-secondary:hover {
      background: var(--border);
    }
    
    .level-locked-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1999;
      animation: levelLockedFadeIn 0.3s ease-out;
    }
    
    @keyframes levelLockedSlideIn {
      from {
        opacity: 0;
        transform: translate(-50%, -60%);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%);
      }
    }
    
    @keyframes levelLockedFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @media (max-width: 560px) {
      .level-locked-message {
        padding: 24px;
        margin: 20px;
      }
      
      .level-locked-message .icon {
        font-size: 40px;
      }
      
      .level-locked-message .title {
        font-size: 18px;
      }
      
      .level-locked-message .message {
        font-size: 14px;
      }
      
      .level-locked-message .actions {
        flex-direction: column;
      }
    }
    
    /* Progress Modal Styles */
    .creation-progress-modal {
      max-width: 500px;
      width: 90%;
    }
    
    .progress-container {
      padding: 20px 0;
    }
    
    .progress-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      position: relative;
    }
    
    .progress-steps::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 20px;
      right: 20px;
      height: 2px;
      background: var(--border);
      z-index: 1;
    }
    
    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
      opacity: 0.4;
      transition: all 0.3s ease;
    }
    
    .progress-step.active {
      opacity: 1;
    }
    
    .step-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--surface);
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      margin-bottom: 8px;
      transition: all 0.3s ease;
    }
    
    .progress-step.active .step-icon {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
      transform: scale(1.1);
    }
    
    .step-text {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      text-align: center;
      max-width: 80px;
      line-height: 1.3;
    }
    
    .progress-step.active .step-text {
      color: var(--accent);
      font-weight: 600;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--surface);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), #1d4ed8);
      border-radius: 4px;
      transition: width 0.5s ease;
      width: 0%;
    }
    
    .progress-text {
      text-align: center;
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    @media (max-width: 480px) {
      .progress-steps {
        flex-direction: column;
        gap: 20px;
        align-items: center;
      }
      
      .progress-steps::before {
        display: none;
      }
      
      .step-text {
        max-width: none;
      }
    }
  </style>
  <script>
    (function(){
      const _fetch = window.fetch;
      window.fetch = async function(input, init){
        const req = input;
        const opts = init || {};
        try{
          const url = (typeof req === 'string') ? req : (req && req.url) || '';
          const method = String((opts.method||'GET')).toUpperCase();
          if(url.includes('/api/level/stats') && method === 'POST'){
            let lvl = null;
            try{
              const raw = opts.body;
              const obj = typeof raw === 'string' ? JSON.parse(raw) : raw;
              lvl = obj && (obj.level ?? obj.lvl ?? obj.id);
            }catch(_){ lvl = null; }
            const qs = (lvl!==null && lvl!==undefined) ? `?level=${encodeURIComponent(lvl)}` : '';
            return _fetch(`/api/level/stats${qs}`, { method:'GET', headers: opts.headers });
          }
        }catch(_){ /* fall through */ }
        return _fetch(req, opts);
      };
    })();
  </script>
  <script>
    (function(){
      function applyCoursePrefs(){
        try{
          var langSel=document.getElementById('target-lang');
          var lang=(langSel&&langSel.value)||'en';
          // Prefer per-language topic if present
          try{
            var tkey = 'siluma_topic_' + lang;
            var tval = localStorage.getItem(tkey);
            if(tval && document.getElementById('topic')){
              document.getElementById('topic').value = tval;
            }
          }catch(e){}
          var key='siluma_course_'+lang;
          var raw=localStorage.getItem(key);
          if(!raw) return;
          var prefs={}; try{ prefs=JSON.parse(raw)||{}; }catch(e){ prefs={}; }
          if(prefs.cefr && document.getElementById('cefr')) document.getElementById('cefr').value=prefs.cefr;
          if(typeof prefs.topic==='string' && document.getElementById('topic') && !localStorage.getItem('siluma_topic_'+lang)) document.getElementById('topic').value=prefs.topic;
        }catch(e){}
      }
      if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', applyCoursePrefs);
      else applyCoursePrefs();
    })();
  </script>
</head>
<body>
  <div id="loader" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px) saturate(120%);z-index:1500">
    <div class="loader-box"><div class="spinner"></div><div class="loader-text" data-i18n="ui.loading_result">Lade Ergebnis…</div></div>
  </div>
  <div id="dbg" style="position:fixed;left:8px;bottom:8px;font:12px/1.2 system-ui;background:var(--surface);color:var(--text-secondary);padding:6px 8px;border:1px solid var(--border);border-radius:6px;z-index:2000" data-i18n="ui.rendered">rendered</div>
  <div class="stage-16x9"><div class="stage-inner">
  <div class="shell">
    <!-- Combined Navigation Bar -->
    <div id="main-navigation" class="main-navigation">
      <div class="nav-tabs">
        <!-- Main Navigation Tabs -->
        <button class="nav-tab active" data-tab="library">
          <span class="tab-icon">🎓</span>
          <span class="tab-label">Polo</span>
        </button>
        <button class="nav-tab" data-tab="browse">
          <span class="tab-icon">🔍</span>
          <span class="tab-label" data-i18n="tabs.browse">Durchsuchen</span>
        </button>
        
        <!-- Course Selection -->
        <button class="nav-tab course-tab" id="course-tab-trigger" data-tab="courses">
          <span class="tab-icon">🌍</span>
          <span class="tab-label">Kurse</span>
          <div class="course-selector">
            <div class="course-select-wrapper">
              <select id="target-lang" class="course-select">
                <option value="" disabled selected>Sprache wählen...</option>
              </select>
              <div class="select-arrow">▼</div>
            </div>
          </div>
        </button>
        <button class="nav-tab" data-tab="words">
          <span class="tab-icon">📝</span>
          <span class="tab-label" data-i18n="tabs.words">Wörter</span>
        </button>
        
        <!-- User Authentication -->
        <button type="button" class="user-tab">
          <div id="auth-section" class="user-section" style="display: none;">
            <div class="user-info" id="user-info-tooltip-trigger">
              <div class="user-avatar">
                <span class="avatar-icon">👤</span>
              </div>
              <div class="user-details">
                <span id="user-name" class="user-name"></span>
                <span class="user-status">Online</span>
              </div>
            </div>
          </div>
          <div id="login-section" class="login-section">
            <div class="user-info" id="login-info-trigger">
              <div class="user-avatar">
                <span class="avatar-icon">🔑</span>
              </div>
              <div class="user-details">
                <span class="user-name" data-i18n="topbar.login">Anmelden</span>
                <span class="user-status" data-i18n="topbar.register">Registrieren</span>
              </div>
            </div>
          </div>
        </button>
      </div>
    </div>

    <!-- Logout Tooltip -->
    <div id="logout-tooltip" class="tooltip" style="display: none; position: absolute; z-index: 1000;">
      <div class="tooltip-content">
        <button id="settings-btn-tooltip" class="action-btn secondary">
          <span class="btn-icon">⚙️</span>
          <span class="btn-text" data-i18n="topbar.settings">Einstellungen</span>
        </button>
        <button id="logout-btn-tooltip" class="action-btn secondary">
          <span class="btn-icon">🚪</span>
          <span class="btn-text" data-i18n="topbar.logout">Abmelden</span>
        </button>
      </div>
    </div>

    <!-- Login/Register Dropdown -->
    <div id="login-dropdown" class="dropdown-menu" style="display: none; position: fixed; z-index: 1000;">
      <div class="dropdown-content">
        <button id="login-dropdown-btn" class="dropdown-item">
          <span class="dropdown-icon">🔑</span>
          <span class="dropdown-text" data-i18n="topbar.login">Anmelden</span>
        </button>
        <button id="register-dropdown-btn" class="dropdown-item">
          <span class="dropdown-icon">✨</span>
          <span class="dropdown-text" data-i18n="topbar.register">Registrieren</span>
        </button>
        <button id="settings-dropdown-btn" class="dropdown-item">
          <span class="dropdown-icon">⚙️</span>
          <span class="dropdown-text" data-i18n="topbar.settings">Einstellungen</span>
        </button>
      </div>
    </div>

    <div class="global-stat-bar" aria-live="polite">
      <div class="stat-card" id="words-stat-card">
        <div class="stat-icon">📖</div>
        <div class="stat-content">
          <div class="stat-label">Wörter</div>
          <div id="total-words-count" class="stat-value">0</div>
        </div>
      </div>
      <div class="stat-card" id="learned-stat-card">
        <div class="stat-icon">💡</div>
        <div class="stat-content">
          <div class="stat-label">Gelernt</div>
          <div id="memorized-words-count" class="stat-value">0</div>
        </div>
      </div>
    </div>

    <section id="levels-card" class="card">
      <!-- Enhanced Course Configuration -->
      <div class="enhanced-course-config">
          
        <!-- Course Settings Section -->
        <div class="config-settings">
          <div class="settings-row">
          <div class="config-item">
              <label for="cefr" class="config-label">
              <span class="config-icon">📊</span>
                <span data-i18n="labels.level">Sprachniveau</span>
              </label>
            <div class="select-wrapper">
              <select id="cefr" class="modern-select">
                <option value="none">A0 - Beginner</option>
                <option value="A1">A1 - Elementary</option>
                <option value="A2">A2 - Pre-Intermediate</option>
                <option value="B1">B1 - Intermediate</option>
                <option value="B2">B2 - Upper-Intermediate</option>
                <option value="C1">C1 - Advanced</option>
                <option value="C2">C2 - Proficient</option>
          </select>
              <div class="select-arrow">▼</div>
        </div>
          </div>
          
          <div class="config-item">
              <label for="topic" class="config-label">
              <span class="config-icon">🎯</span>
                <span data-i18n="labels.motivation">Motivation</span>
              </label>
            <div class="select-wrapper">
              <select id="topic" class="modern-select">
            <option value="daily life" data-i18n="topics.daily_life">Alltagsleben</option>
            <option value="travel" data-i18n="topics.travel">Reise</option>
            <option value="work" data-i18n="topics.work">Arbeit</option>
            <option value="food" data-i18n="topics.food">Essen</option>
          </select>
              <div class="select-arrow">▼</div>
              </div>
            </div>
          </div>
        </div>

      </div>
      <!-- Tab Content Areas -->
      <div id="tab-content">
        <!-- Library Tab Content -->
        <div id="library-tab" class="tab-content active">
          <div class="library-content">
            <div class="library-header">
              <div>
                <h2 class="library-title" data-i18n="library.title">📚 Meine Bibliothek</h2>
                <p class="library-subtitle" data-i18n="library.subtitle">Deine gespeicherten Kurse und Fortschritte</p>
              </div>
            </div>
            
            <!-- Quick Actions Section -->
            <div class="library-quick-actions">
              <h3 class="quick-actions-title" data-i18n="library.quick_actions">Schnellzugriff</h3>
              <div class="quick-actions-buttons">
                <button id="smart-practice-btn" class="quick-action-btn primary" type="button">
                  <span class="btn-icon">💪</span>
                  <span class="btn-label" data-i18n="library.practice">Übung</span>
                  <span class="btn-description" data-i18n="library.practice_desc">Intelligente Wiederholung</span>
                </button>
                <button id="create-custom-levels-btn" class="quick-action-btn" type="button">
                  <span class="btn-icon">🎯</span>
                  <span class="btn-label">Level erstellen</span>
                  <span class="btn-description">AI-generierte Level-Gruppen</span>
                </button>
                <button id="alphabet-practice-btn" class="quick-action-btn" type="button">
                  <span class="btn-icon">🔤</span>
                  <span class="btn-label" data-i18n="library.alphabet">Alphabet</span>
                  <span class="btn-description" data-i18n="library.alphabet_desc">Lerne das Alphabet</span>
                </button>
              </div>
            </div>
            
            <!-- Custom Level Groups Section -->
            <div id="custom-level-groups-section" class="library-section">
                <div class="section-header">
                    <h2 data-i18n="library.custom_groups">🎯 Benutzerdefinierte Level-Gruppen</h2>
                    <p>Deine persönlichen, AI-generierten Level-Gruppen</p>
                </div>
                <div id="custom-level-groups-container">
                    <!-- Custom level groups will be loaded here by JavaScript -->
                </div>
            </div>
            
            <!-- Standard Level Groups Section (Removed - groups are disabled) -->
            <!-- The level-groups div is still needed for JavaScript functionality -->
            <div id="level-groups" class="level-groups-grid" style="display: none;"></div>
            
            <!-- Existing levels content -->
            <section>
              <div id="levels-group-header" class="levels-group-header" style="display:none">
                <div class="levels-group-title-wrap">
                  <div class="levels-group-heading" id="levels-group-title"></div>
                  <div class="levels-group-subtitle" id="levels-group-subtitle"></div>
                </div>
                <button id="levels-group-back" type="button" class="levels-group-back">
                  ← <span data-i18n="buttons.back_to_overview">Back to Overview</span>
                </button>
              </div>
              <div id="levels" class="levels" style="display:none"></div>
            </section>
          </div>
        </div>
        
        
        <!-- Browse Tab Content -->
        <div id="browse-tab" class="tab-content">
          <div class="browse-content">
            <div class="browse-header">
              <h2 class="browse-title" data-i18n="browse.title">🔍 Marketplace</h2>
              <p class="browse-subtitle" data-i18n="browse.subtitle">Entdecke Level-Gruppen von anderen Nutzern</p>
            </div>
            
            <div class="marketplace-content">
              
              <div id="marketplace-groups-container" class="marketplace-groups-container">
                <div class="marketplace-loading">
                  <div class="loading-spinner"></div>
                  <p>Lade Marketplace-Inhalte...</p>
                </div>
              </div>
              
              <div id="marketplace-pagination" class="marketplace-pagination" style="display: none;">
                <button id="marketplace-prev-btn" class="btn btn-secondary" onclick="loadMarketplaceGroups('prev')" disabled>
                  ← Zurück
                </button>
                <span id="marketplace-page-info" class="page-info">Seite 1 von 1</span>
                <button id="marketplace-next-btn" class="btn btn-secondary" onclick="loadMarketplaceGroups('next')" disabled>
                  Weiter →
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Courses Tab Content -->
        <div id="courses-tab" class="tab-content">
          <div class="courses-container">
            <div class="courses-header">
              <h2 class="courses-title" data-i18n="courses.title">🌍 Languages</h2>
              <p class="courses-subtitle" data-i18n="courses.subtitle">Choose a language to start learning</p>
            </div>
            
            <div class="courses-grid" id="courses-grid">
              <!-- Course cards will be dynamically generated here -->
            </div>
            
            <div class="courses-loading" id="courses-loading" style="display: none;">
              <div class="loading-spinner"></div>
              <p>Lade verfügbare Sprachen...</p>
            </div>
            
            <div class="courses-error" id="courses-error" style="display: none;">
              <div class="error-icon">⚠️</div>
              <p>Fehler beim Laden der Sprachen. Bitte versuche es erneut.</p>
              <button id="retry-courses" class="retry-btn">Erneut versuchen</button>
            </div>
          </div>
        </div>

        <!-- Words Tab Content -->
        <div id="words-tab" class="tab-content">
          <div class="words-learning">
            <div class="words-learning-header">
              <div>
                <h2 class="words-learning-title" data-i18n="words.learning.title">Wörter, die ich gerade lerne</h2>
                <p class="words-learning-subtitle" data-i18n="words.learning.subtitle">Verfolge deine aktiven Lernwörter und ihren Fortschritt</p>
              </div>
            </div>

            <div class="words-learning-controls">
              <div class="words-filters" id="words-filter-group">
                <button type="button" class="words-filter-chip active" data-filter="all" data-i18n="words.learning.filter.all">Alle Wörter</button>
                <button type="button" class="words-filter-chip" data-filter="new" data-i18n="words.learning.filter.new">Neu</button>
                <button type="button" class="words-filter-chip" data-filter="learning" data-i18n="words.learning.filter.learning">In Arbeit</button>
                <button type="button" class="words-filter-chip" data-filter="confident" data-i18n="words.learning.filter.confident">Fast geschafft</button>
              </div>
              <div class="words-search-sort">
                <div class="words-search">
                  <span class="words-search-icon">🔍</span>
                  <input id="words-search-input" class="words-search-input" type="search" data-i18n-placeholder="words.learning.search_placeholder" placeholder="Nach einem Wort suchen...">
                </div>
                <div class="words-sort">
                  <label for="words-sort-select" class="words-sort-label" data-i18n="words.learning.sort.label">Sortierung</label>
                  <select id="words-sort-select" class="words-sort-select">
                    <option value="recent" data-i18n="words.learning.sort.recent">Zuletzt geübt</option>
                    <option value="challenge" data-i18n="words.learning.sort.difficulty">Größte Herausforderung</option>
                    <option value="alphabetical" data-i18n="words.learning.sort.alphabetical">Alphabetisch</option>
                  </select>
                </div>
              </div>
            </div>

            <div id="words-learning-loading" class="words-learning-loading" style="display:none;">
              <div class="loading-spinner"></div>
              <p data-i18n="ui.loading_result">Lade Ergebnis…</p>
            </div>

            <div id="words-learning-auth" class="words-learning-message" style="display:none;">
              <div class="message-card">
                <h3 data-i18n="words.learning.login_title">Melde dich an, um loszulegen</h3>
                <p data-i18n="words.learning.login_copy">Hier erscheinen alle Wörter, die du aktiv übst. Melde dich an, um deine persönliche Liste zu sehen.</p>
                <button id="words-login-button" class="primary-btn" type="button" data-i18n="topbar.login">Anmelden</button>
              </div>
            </div>

            <div id="words-learning-language" class="words-learning-message" style="display:none;">
              <div class="message-card">
                <h3 data-i18n="words.learning.language_title">Sprache auswählen</h3>
                <p data-i18n="words.learning.language_copy">Wähle oben eine Kurssprache, um deine aktuellen Lernwörter anzuzeigen.</p>
              </div>
            </div>

            <div id="words-learning-empty" class="words-learning-message" style="display:none;">
              <div class="message-card">
                <h3 data-i18n="words.learning.empty_title">Du bist auf einem großartigen Lauf!</h3>
                <p data-i18n="words.learning.empty_copy">Sobald du neue Wörter übst, tauchen sie hier mit ihren Fortschrittsdetails auf.</p>
              </div>
            </div>

            <div id="words-learning-error" class="words-learning-message" style="display:none;">
              <div class="message-card">
                <h3 data-i18n="words.learning.error_title">Da ist etwas schiefgelaufen</h3>
                <p id="words-error-message" data-i18n="words.learning.error_copy">Die Wörter konnten nicht geladen werden. Bitte versuche es später noch einmal.</p>
              </div>
            </div>

            <div id="words-learning-grid" class="words-learning-grid"></div>
          </div>
        </div>

        <!-- Settings Tab Content -->
        <div id="settings-tab" class="tab-content">
          <div class="settings-content">
            <div class="settings-header">
              <h2 class="settings-title" data-i18n="settings.title">⚙️ Einstellungen</h2>
              <p class="settings-subtitle" data-i18n="settings.subtitle">Verwalte deine App-Einstellungen und Präferenzen</p>
              <div class="settings-auto-save-indicator" id="settings-auto-save-indicator" style="display: none;">
                <span class="auto-save-icon">💾</span>
                <span class="auto-save-text">Einstellungen werden automatisch gespeichert</span>
              </div>
            </div>
            
            <div class="settings-sections">
              <!-- Display Settings -->
              <div class="settings-section">
                <h3 class="settings-section-title" data-i18n="settings.display">Anzeige</h3>
                <div class="settings-item">
                  <label class="settings-label" data-i18n="settings.theme">Design</label>
                  <select id="settings-theme" class="settings-select">
                    <option value="light" data-i18n="settings.theme_light">Hell</option>
                    <option value="dark" data-i18n="settings.theme_dark">Dunkel</option>
                    <option value="auto" data-i18n="settings.theme_auto">Automatisch</option>
                  </select>
                </div>
              </div>
              
              <!-- Language Settings -->
              <div class="settings-section">
                <h3 class="settings-section-title" data-i18n="settings.language">Sprache</h3>
                <div class="settings-item">
                  <label class="settings-label" data-i18n="settings.native_language">Muttersprache</label>
                  <select id="settings-native-lang" class="settings-select">
                    <!-- Options will be populated dynamically -->
                  </select>
                </div>
              </div>
              
              
              <!-- Audio Settings -->
              <div class="settings-section">
                <h3 class="settings-section-title" data-i18n="settings.audio">Audio</h3>
                <div class="settings-item">
                  <label class="settings-checkbox-label">
                    <input type="checkbox" id="settings-auto-play" class="settings-checkbox" checked>
                    <span class="settings-checkbox-text" data-i18n="settings.auto_play">Automatisches Abspielen</span>
                  </label>
                </div>
                <div class="settings-item">
                  <label class="settings-checkbox-label">
                    <input type="checkbox" id="settings-sound-effects" class="settings-checkbox" checked>
                    <span class="settings-checkbox-text" data-i18n="settings.sound_effects">Soundeffekte</span>
                  </label>
                </div>
              </div>
              
              <!-- Account Settings -->
              <div class="settings-section">
                <h3 class="settings-section-title" data-i18n="settings.account">Konto</h3>
                <div class="settings-item">
                  <button id="settings-logout" class="settings-button danger" data-i18n="settings.logout">Abmelden</button>
                </div>
                <div class="settings-item">
                  <button id="settings-delete-account" class="settings-button danger" data-i18n="settings.delete_account">Konto löschen</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  <script id="curriculum-spec" type="application/json">
  {
    "sections": [
      {"name":"Foundations","range":[1,10],"themes":[
        "Sich vorstellen","Begrüßungen","Familie & Freunde","Zahlen & Zeit",
        "Alltagswörter & Farben","Höflichkeit & Etikette","Fragen & Antworten",
        "Orientierung & Transport","Einkaufen (Markt)","Wiederholung I"
      ]},
      {"name":"Alltag & Survival","range":[11,20],"themes":[
        "Essen & Trinken (Restaurant)","Unterkunft","Einkaufen (Kleidung)","Arbeit & Schule",
        "Gesundheit","Freizeit & Hobbys","Reisen","Notfälle","Digitale Welt","Wiederholung II"
      ]},
      {"name":"Kultur & Gesellschaft","range":[21,30],"themes":[
        "Knigge & Umgangsformen","Alltagsszenen","Gesellschaftliche Strukturen","Medien & Popkultur",
        "Sprichwörter & Redewendungen","Humor & Slang","Landesküche & Traditionen",
        "Regionale Unterschiede & Dialekte","Interkulturelle Vergleiche","Wiederholung III"
      ]},
      {"name":"Geschichte & Identität","range":[31,40],"themes":[
        "Entstehungsgeschichte","Wendepunkte","Historisch bedingte Eigenheiten","Identität & Selbstverständnis",
        "Politik & Systeme","Migration & Integration","Internationale Rolle",
        "Literatur & Philosophie","Moderne Geschichte","Wiederholung IV"
      ]},
      {"name":"Spezialisierung","range":[41,50],"themes":[
        "Business & Karriere","Reisen & Abenteuer","Wissenschaft & Technik","Kunst & Literatur",
        "Akademisch Schreiben","Verhandeln & Präsentieren","Kundensupport & Service",
        "Gespräche am Arbeitsplatz","Fachsprache nach Wahl","Wiederholung V"
      ]}
    ],
    "defaultTemplate": "You are generating a language lesson. Target language: {{target_lang}}. Learner native language: {{native_lang}}. CEFR: {{cefr}}. Global topic: {{topic}}. Section: {{section_name}}. Level: {{level}}. Level theme: {{theme}}.\nConstraints: Keep sentences natural for {{target_lang}}, align difficulty to CEFR {{cefr}}. Avoid proper names unless culturally relevant. Prefer everyday contexts.\nOutput JSON with: {\\\"items\\\":[{\\\"text_target\\\":string,\\\"words\\\":[string...]}],\\\"meta\\\":{\\\"level\\\":number,\\\"section\\\":string,\\\"theme\\\":string}}.\nItems: 6-10 per level. Each text 5-14 words. Include diverse grammar matching the section focus. Ensure words[] lists unique lower-cased tokens from text_target. No translations in output.",
    "sectionHints": {
      "Foundations": "Focus on greetings, introductions, polite phrases, basic Q&A, numbers, time.",
      "Alltag & Survival": "Restaurant, lodging, shopping, health, travel, emergencies; include service interactions.",
      "Kultur & Gesellschaft": "Embed cultural practices, idioms, informal vs formal registers; short cultural notes implied in contexts.",
      "Geschichte & Identität": "Historical references in simple narratives; identities and institutions; stay neutral.",
      "Spezialisierung": "Adapt to user-selected subtopic; workplace and domain-specific routines; keep sentences practical."
    }
  }
  </script>

    <section id="lesson" class="card" style="display:none">
      <!-- Progress only inside lesson -->
      <div id="progress-block" class="row" style="display:none; margin-bottom:12px">
        <div class="bar" id="progress-wrap"><i id="progress"></i></div>
      </div>
      <!-- Enhanced Instruction Panel - moved to top for better UX -->
      <div id="result" class="hint" style="margin-bottom:8px"></div>
      <div id="sentence-wrap" class="sentence"></div>
      <div class="row" style="margin-top:12px">
        <textarea id="user-translation" data-i18n-placeholder="labels.translation" placeholder="Ihre Übersetzung hier…"></textarea>
      </div>
      <div class="row actions" style="margin-top:8px">
        <button id="abort-level" class="secondary" data-i18n="buttons.abort">Cancel</button>
        <div class="grow"></div>
        <button id="check" data-i18n="buttons.check_answer">Check Answer</button>
      </div>
    </section>
    <section id="evaluation-card" class="card eval" style="display:none">
      <!-- Success Header -->
      <div class="eval-header" style="text-align: center; margin-bottom: 32px;">
        <div class="success-icon" style="font-size: 64px; margin-bottom: 16px;">🎉</div>
        <h3 class="eval-title" data-i18n="status.level_completed">Level abgeschlossen!</h3>
        <p class="eval-subtitle" data-i18n="evaluation.congratulations">Herzlichen Glückwunsch! Sie haben dieses Level erfolgreich gemeistert.</p>
      </div>

      <!-- Level Progress Ring -->
      <div class="eval-progress" style="display: flex; justify-content: center; margin-bottom: 32px;">
        <div class="progress-ring-container" style="position: relative; width: 120px; height: 120px;">
          <svg class="progress-ring" width="120" height="120" style="transform: rotate(-90deg);">
            <circle class="progress-ring-background" cx="60" cy="60" r="50" stroke="var(--border)" stroke-width="8" fill="transparent"/>
            <circle id="eval-ring" class="progress-ring-fill" cx="60" cy="60" r="50" stroke="var(--accent)" stroke-width="8" fill="transparent" stroke-linecap="round" style="stroke-dasharray: 314.16; stroke-dashoffset: 314.16; transition: stroke-dashoffset 0.5s ease-in-out;"/>
          </svg>
          <div id="eval-ring-txt" class="progress-text" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 24px; font-weight: 700; color: var(--accent);">0%</div>
        </div>
      </div>
      
      <!-- Level Statistics -->
      <div class="eval-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 16px; margin-bottom: 32px;">
        <div class="stat-card" style="background: var(--surface); border-radius: 12px; padding: 16px; text-align: center; border: 1px solid var(--border);">
          <div class="stat-icon" style="font-size: 24px; margin-bottom: 8px;">📚</div>
          <div class="stat-value" id="total-words" style="font-size: 20px; font-weight: 700; color: var(--accent);">0</div>
          <div class="stat-label" data-i18n="evaluation.total_words">Wörter gesamt</div>
        </div>
        <div class="stat-card" style="background: var(--surface); border-radius: 12px; padding: 16px; text-align: center; border: 1px solid var(--border);">
          <div class="stat-icon" style="font-size: 24px; margin-bottom: 8px;">✅</div>
          <div class="stat-value" id="learned-words" style="font-size: 20px; font-weight: 700; color: #10b981;">0</div>
          <div class="stat-label" data-i18n="evaluation.learned_words">Gelernt</div>
        </div>
        <div class="stat-card" style="background: var(--surface); border-radius: 12px; padding: 16px; text-align: center; border: 1px solid var(--border);">
          <div class="stat-icon" style="font-size: 24px; margin-bottom: 8px;">🎯</div>
          <div class="stat-value" id="accuracy" style="font-size: 20px; font-weight: 700; color: #f59e0b;">0%</div>
          <div class="stat-label" data-i18n="evaluation.accuracy">Genauigkeit</div>
        </div>
      </div>

      <!-- Word Familiarity Breakdown -->
      <div class="familiarity-breakdown" style="margin-bottom: 32px;">
        <h4 style="text-align: center; margin-bottom: 16px; color: var(--text);" data-i18n="evaluation.word_progress">Wort-Fortschritt</h4>
        <div class="familiarity-bars" style="display: grid; gap: 8px;">
          <div class="familiarity-bar" data-status="5" style="display: flex; align-items: center; gap: 12px; padding: 8px 12px; background: var(--surface); border-radius: 8px; border: 1px solid var(--border);">
            <div class="familiarity-label" style="min-width: 80px; font-size: 14px; color: var(--text-secondary);">Gelernt</div>
            <div class="familiarity-progress" style="flex: 1; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
              <div class="familiarity-fill" style="height: 100%; background: #10b981; width: 0%; transition: width 0.5s ease-in-out;"></div>
            </div>
            <div class="familiarity-count" style="min-width: 30px; text-align: right; font-weight: 600; color: var(--text);">0</div>
          </div>
          <div class="familiarity-bar" data-status="4" style="display: flex; align-items: center; gap: 12px; padding: 8px 12px; background: var(--surface); border-radius: 8px; border: 1px solid var(--border);">
            <div class="familiarity-label" style="min-width: 80px; font-size: 14px; color: var(--text-secondary);">Fast gelernt</div>
            <div class="familiarity-progress" style="flex: 1; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
              <div class="familiarity-fill" style="height: 100%; background: #3b82f6; width: 0%; transition: width 0.5s ease-in-out;"></div>
            </div>
            <div class="familiarity-count" style="min-width: 30px; text-align: right; font-weight: 600; color: var(--text);">0</div>
          </div>
          <div class="familiarity-bar" data-status="3" style="display: flex; align-items: center; gap: 12px; padding: 8px 12px; background: var(--surface); border-radius: 8px; border: 1px solid var(--border);">
            <div class="familiarity-label" style="min-width: 80px; font-size: 14px; color: var(--text-secondary);">Fortgeschritten</div>
            <div class="familiarity-progress" style="flex: 1; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
              <div class="familiarity-fill" style="height: 100%; background: #8b5cf6; width: 0%; transition: width 0.5s ease-in-out;"></div>
            </div>
            <div class="familiarity-count" style="min-width: 30px; text-align: right; font-weight: 600; color: var(--text);">0</div>
          </div>
          <div class="familiarity-bar" data-status="2" style="display: flex; align-items: center; gap: 12px; padding: 8px 12px; background: var(--surface); border-radius: 8px; border: 1px solid var(--border);">
            <div class="familiarity-label" style="min-width: 80px; font-size: 14px; color: var(--text-secondary);">Bekannt</div>
            <div class="familiarity-progress" style="flex: 1; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
              <div class="familiarity-fill" style="height: 100%; background: #f59e0b; width: 0%; transition: width 0.5s ease-in-out;"></div>
            </div>
            <div class="familiarity-count" style="min-width: 30px; text-align: right; font-weight: 600; color: var(--text);">0</div>
          </div>
          <div class="familiarity-bar" data-status="1" style="display: flex; align-items: center; gap: 12px; padding: 8px 12px; background: var(--surface); border-radius: 8px; border: 1px solid var(--border);">
            <div class="familiarity-label" style="min-width: 80px; font-size: 14px; color: var(--text-secondary);">Gesehen</div>
            <div class="familiarity-progress" style="flex: 1; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
              <div class="familiarity-fill" style="height: 100%; background: #ef4444; width: 0%; transition: width 0.5s ease-in-out;"></div>
            </div>
            <div class="familiarity-count" style="min-width: 30px; text-align: right; font-weight: 600; color: var(--text);">0</div>
          </div>
          <div class="familiarity-bar" data-status="0" style="display: flex; align-items: center; gap: 12px; padding: 8px 12px; background: var(--surface); border-radius: 8px; border: 1px solid var(--border);">
            <div class="familiarity-label" style="min-width: 80px; font-size: 14px; color: var(--text-secondary);">Neu</div>
            <div class="familiarity-progress" style="flex: 1; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
              <div class="familiarity-fill" style="height: 100%; background: #6b7280; width: 0%; transition: width 0.5s ease-in-out;"></div>
            </div>
            <div class="familiarity-count" style="min-width: 30px; text-align: right; font-weight: 600; color: var(--text);">0</div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="eval-actions" style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
        <button id="eval-practice" class="secondary" data-i18n="buttons.practice_difficult" style="display: flex; align-items: center; gap: 8px; padding: 12px 20px;">
          <span>📚</span>
          <span>Schwierige Wörter üben</span>
        </button>
        <button id="eval-back" data-i18n="buttons.back_to_overview" style="display: flex; align-items: center; gap: 8px; padding: 12px 20px;">
          <span>🏠</span>
          <span>Zurück zur Übersicht</span>
        </button>
      </div>
    </section>
  </div>
  </div></div>


    <div id="level-tip" style="display:none">
    <header>
        <div id="lt-title" data-fixed-title="true">Level</div>
        <div id="lt-close">×</div>
    </header>
      <div class="body">
        <!-- Level Information -->
        <div class="level-info">
          <div class="info-row">
            <span class="info-label" data-i18n="tooltip.status">Status</span>
            <span class="info-value" id="lt-status">Available</span>
    </div>
          <div class="info-row">
            <span class="info-label" data-i18n="tooltip.theme">Theme</span>
            <span class="info-value" id="lt-theme">Daily Life</span>
  </div>
          <div class="info-row">
            <span class="info-label" data-i18n="tooltip.difficulty">Difficulty</span>
            <span class="info-value" id="lt-difficulty">Beginner</span>
          </div>
        </div>
        
        
          <div class="info-row">
            <span class="info-label" data-i18n="tooltip.words">Words</span>
            <span class="info-value" id="lt-words-count">0</span>
          </div>
          <div class="info-row">
            <span class="info-label" data-i18n="tooltip.completed">Completed</span>
            <span class="info-value" id="lt-completed-count">0</span>
          </div>
        
      </div>
    </div>
  <div id="tooltip" role="dialog" aria-modal="false" style="position:fixed;z-index:200">
    <header>
      <h4 id="tt-title">Wort</h4>
      <div class="row" style="gap:8px;align-items:center">
        <button id="tt-enrich" class="icon-btn" title="Befüllen">
          <span aria-hidden="true">✨</span>
        </button>
        <button id="tt-save" class="icon-btn" title="Speichern" style="display:none" aria-hidden="true">
          <span aria-hidden="true">💾</span>
        </button>
        <button id="tt-audio-btn" class="icon-btn" title="Audio abspielen">
          <span aria-hidden="true">🔊</span>
        </button>
        <div id="tt-close" class="x">×</div>
      </div>
    </header>
    <audio id="tt-audio-el" style="display:none" preload="none"></audio>
    <div class="body">
      <div class="tooltip-field">
        <label>Übersetzung</label>
        <div id="tt-translation" class="tooltip-text-field">–</div>
      </div>
      
      <div class="tooltip-field">
        <label>Aussprache (IPA) <span id="tt-badge-ipa" class="pill" style="margin-left:6px;background:var(--surface);color:var(--text-secondary)">Zielsprache</span></label>
        <div id="tt-ipa" class="tooltip-text-field">–</div>
      </div>
      
      <div class="tooltip-field">
        <label>Genus</label>
        <div id="tt-gender" class="tooltip-text-field">–</div>
      </div>
      
      <!-- Beispielsatz ausgeblendet, Element bleibt für eventuelle JS-Zugriffe erhalten -->
      <label style="display:none">Beispielsatz
        <textarea id="tt-example" placeholder="Beispiel eingeben"></textarea>
      </label>
      
      <div class="tooltip-field">
        <label>Beispiel-Übersetzung <span id="tt-badge-example-native" class="pill" style="margin-left:6px;background:var(--surface);color:var(--text-secondary)">Muttersprache</span></label>
        <div id="tt-example-native" class="tooltip-text-field">–</div>
      </div>
      
      <div class="tooltip-field">
        <label>Synonyme <span id="tt-badge-syn" class="pill" style="margin-left:6px;background:var(--surface);color:var(--text-secondary)">Zielsprache</span></label>
        <div id="tt-syn" class="tooltip-text-field">–</div>
      </div>
      
      <div class="tooltip-field">
        <label>Wortart</label>
        <div id="tt-pos" class="tooltip-text-field">–</div>
      </div>
      
      <div class="tooltip-field">
        <label>Bekanntheit</label>
        <select id="tt-fam" class="tooltip-editable">
          <option value="0" data-i18n="familiarity.unknown">Unbekannt</option>
          <option value="1" data-i18n="familiarity.seen">Gesehen</option>
          <option value="2" data-i18n="familiarity.learning">Lernen</option>
          <option value="3" data-i18n="familiarity.familiar">Vertraut</option>
          <option value="4" data-i18n="familiarity.strong">Stark</option>
          <option value="5" data-i18n="familiarity.memorized">Auswendig</option>
        </select>
      </div>
      
      <div class="tooltip-field">
        <label>Kommentar</label>
        <textarea id="tt-user-comment" class="tooltip-editable" placeholder="Persönlicher Kommentar zu diesem Wort..." rows="3"></textarea>
      </div>
      
      <!-- Hidden elements for JS compatibility -->
      <input id="tt-translation-input" style="display:none" />
      <input id="tt-ipa-input" style="display:none" />
      <select id="tt-gender-select" style="display:none"></select>
      <textarea id="tt-example-native-textarea" style="display:none"></textarea>
      <input id="tt-syn-input" style="display:none" />
      <select id="tt-pos-select" style="display:none">
        <option value="">–</option>
        <option value="NOUN">Nomen</option>
        <option value="VERB">Verb</option>
        <option value="ADJ">Adjektiv</option>
        <option value="ADV">Adverb</option>
        <option value="PRON">Pronomen</option>
        <option value="DET">Artikel/Det</option>
        <option value="PREP">Präposition</option>
        <option value="CONJ">Konjunktion</option>
        <option value="NUM">Numerale</option>
        <option value="PART">Partikel</option>
        <option value="INTJ">Interjektion</option>
      </select>          <option value="INTJ">Interjektion</option>
        </select>
      </label>
    </div>
  </div>

  <!-- Inline script removed; app logic and helpers are now loaded via ES modules. -->
  <script id="curriculum-spec" type="application/json">
  {
    "sections": [
      {"name":"Foundations","range":[1,10],"themes":[
        "Sich vorstellen","Basisgespräche","Familie & Freunde","Zahlen & Zeit",
        "Alltagsgegenstände & Farben","Höflichkeit & Etikette","Fragen & Antworten",
        "Orientierung & Transport","Einkaufen (Markt)","Wiederholung I"
      ]},
      {"name":"Alltag & Survival","range":[11,20],"themes":[
        "Essen & Trinken (Restaurant)","Unterkunft","Einkaufen (Kleidung)","Arbeit & Schule",
        "Gesundheit","Freizeit & Hobbys","Reisen","Notfälle","Digitale Welt","Wiederholung II"
      ]},
      {"name":"Kultur & Gesellschaft","range":[21,30],"themes":[
        "Knigge & Umgangsformen","Alltagsszenen","Gesellschaftliche Strukturen","Medien & Popkultur",
        "Sprichwörter & Redewendungen","Humor & Slang","Landesküche & Traditionen",
        "Regionale Unterschiede & Dialekte","Interkulturelle Vergleiche","Wiederholung III"
      ]},
      {"name":"Geschichte & Identität","range":[31,40],"themes":[
        "Entstehungsgeschichte","Wendepunkte","Historisch bedingte Eigenheiten","Identität & Selbstverständnis",
        "Politik & Systeme","Migration & Integration","Internationale Rolle",
        "Literatur & Philosophie","Moderne Geschichte","Wiederholung IV"
      ]},
      {"name":"Spezialisierung","range":[41,50],"themes":[
        "Business & Karriere","Reisen & Abenteuer","Wissenschaft & Technik","Kunst & Literatur",
        "Akademisch Schreiben","Verhandeln & Präsentieren","Kundensupport & Service",
        "Gespräche am Arbeitsplatz","Fachsprache nach Wahl","Wiederholung V"
      ]}
    ],
    "defaultTemplate": "You are generating a language lesson. Target language: {{target_lang}}. Learner native language: {{native_lang}}. CEFR: {{cefr}}. Global topic: {{topic}}. Section: {{section_name}}. Level: {{level}}. Level theme: {{theme}}.\nConstraints: Keep sentences natural for {{target_lang}}, align difficulty to CEFR {{cefr}}. Avoid proper names unless culturally relevant. Prefer everyday contexts.\nOutput JSON with: {\"items\":[{\"text_target\":string,\"words\":[string...]}],\"meta\":{\"level\":number,\"section\":string,\"theme\":string}}.\nItems: 6-10 per level. Each text 5-14 words. Include diverse grammar matching the section focus. Ensure words[] lists unique lower-cased tokens from text_target. No translations in output.",
    "sectionHints": {
      "Foundations": "Focus on greetings, introductions, polite phrases, basic Q&A, numbers, time.",
      "Alltag & Survival": "Restaurant, lodging, shopping, health, travel, emergencies; include service interactions.",
      "Kultur & Gesellschaft": "Embed cultural practices, idioms, informal vs formal registers; short cultural notes implied in contexts.",
      "Geschichte & Identität": "Historical references in simple narratives; identities and institutions; stay neutral.",
      "Spezialisierung": "Adapt to user-selected subtopic; workplace and domain-specific routines; keep sentences practical."
    }
    ,"goals":["everyday","travel","business","academic","culture"]
    ,"goalAliases":{"daily life":"everyday","work":"business","food":"everyday","travel":"travel"}
    ,"sectionOrderByGoal":{
      "everyday":["Foundations","Alltag & Survival","Kultur & Gesellschaft","Geschichte & Identität","Spezialisierung"],
      "travel":["Foundations","Alltag & Survival","Kultur & Gesellschaft","Spezialisierung","Geschichte & Identität"],
      "business":["Foundations","Alltag & Survival","Spezialisierung","Kultur & Gesellschaft","Geschichte & Identität"],
      "academic":["Foundations","Kultur & Gesellschaft","Spezialisierung","Geschichte & Identität","Alltag & Survival"],
      "culture":["Foundations","Kultur & Gesellschaft","Geschichte & Identität","Alltag & Survival","Spezialisierung"]
    }
    ,"sectionMinCEFR":{"Foundations":"A0","Alltag & Survival":"A1","Kultur & Gesellschaft":"B1","Geschichte & Identität":"B2","Spezialisierung":"B1"}
    ,"cefrStagesDefault":[[1,10,"A1"],[11,20,"A2"],[21,30,"B1"],[31,40,"B2"],[41,45,"C1"],[46,50,"C2"]]
    ,"goalThemes":{
      "Alltag & Survival":{
        "travel":["Reisen","Unterkunft","Transport","Essen & Trinken (Restaurant)","Notfälle","Digitale Welt","Einkaufen (Kleidung)","Gesundheit","Arbeit & Schule","Wiederholung II"],
        "business":["Arbeit & Schule","Einkaufen (Kleidung)","Digitale Welt","Gesundheit","Essen & Trinken (Restaurant)","Unterkunft","Reisen","Notfälle","Freizeit & Hobbys","Wiederholung II"]
      },
      "Spezialisierung":{
        "business":["Business & Karriere","Verhandeln & Präsentieren","Gespräche am Arbeitsplatz","Kundensupport & Service","Akademisch Schreiben","Wissenschaft & Technik","Fachsprache nach Wahl","Reisen & Abenteuer","Kunst & Literatur","Wiederholung V"],
        "academic":["Akademisch Schreiben","Wissenschaft & Technik","Kunst & Literatur","Fachsprache nach Wahl","Business & Karriere","Gespräche am Arbeitsplatz","Verhandeln & Präsentieren","Reisen & Abenteuer","Kundensupport & Service","Wiederholung V"]
      }
    }
    ,"promptGoalLine":"Learner goal: {{goal}}. Prefer contexts aligned with this goal. Avoid unrelated domains."
    ,"promptCEFRPolicy":"Target in-level difficulty: {{cefr_stage}}. Start CEFR: {{start_cefr}}."
  }
  </script>
  
  <!-- Login/Register Modals -->
  <div id="login-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Login</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="login-form">
          <div class="field">
            <label for="login-username">Username or Email</label>
            <input type="text" id="login-username" required>
          </div>
          <div class="field">
            <label for="login-password">Password</label>
            <input type="password" id="login-password" required>
          </div>
          <div class="field">
            <button type="submit" class="primary" style="width: 100%; padding: 12px;">Login</button>
          </div>
        </form>
        <div id="login-error" class="error-message" style="display: none; color: var(--warn); font-size: 14px; margin-top: 12px;"></div>
      </div>
    </div>
  </div>

  <div id="register-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Register</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="register-form">
          <div class="field">
            <label for="register-username">Username</label>
            <input type="text" id="register-username" required minlength="3">
          </div>
          <div class="field">
            <label for="register-email">Email</label>
            <input type="email" id="register-email" required>
          </div>
          <div class="field">
            <label for="register-password">Password</label>
            <input type="password" id="register-password" required minlength="6">
          </div>
          <div class="field">
            <button type="submit" class="primary" style="width: 100%; padding: 12px;">Register</button>
          </div>
        </form>
        <div id="register-error" class="error-message" style="display: none; color: var(--warn); font-size: 14px; margin-top: 12px;"></div>
      </div>
    </div>
  </div>

  <!-- Onboarding Modal -->
  <div id="onboarding-modal" class="modal onboarding-modal" style="display: none;">
    <div class="onboarding-container">
      <div class="onboarding-header">
        <div class="onboarding-progress">
          <div class="progress-bar">
            <div class="progress-fill" id="onboarding-progress-fill"></div>
          </div>
          <span class="progress-text" id="onboarding-progress-text">1 / 4</span>
        </div>
        <button class="onboarding-skip" id="onboarding-skip" data-i18n="onboarding.skip">Skip</button>
      </div>
      
      <div class="onboarding-content">
        <!-- Step 1: Welcome -->
        <div class="onboarding-step active" id="onboarding-step-1">
          <div class="onboarding-icon">🎯</div>
          <h2 data-i18n="onboarding.welcome.title">Welcome to Siluma!</h2>
          <p data-i18n="onboarding.welcome.subtitle">Let's personalize your learning experience in just a few steps.</p>
          <div class="onboarding-actions">
            <button class="primary onboarding-next" data-i18n="onboarding.get_started">Get Started</button>
          </div>
        </div>

        <!-- Step 2: Native Language -->
        <div class="onboarding-step" id="onboarding-step-2">
          <div class="onboarding-icon">🌍</div>
          <h2 data-i18n="onboarding.native_language.title">What's your native language?</h2>
          <p data-i18n="onboarding.native_language.subtitle">This helps us provide better translations and explanations.</p>
          <div class="onboarding-field">
            <select id="onboarding-native-lang" class="onboarding-select">
              <option value="de" data-i18n="language_names.de">Deutsch</option>
              <option value="en" data-i18n="language_names.en">English</option>
            </select>
          </div>
          <div class="onboarding-actions">
            <button class="secondary onboarding-back" data-i18n="onboarding.back">Back</button>
            <button class="primary onboarding-next" data-i18n="onboarding.next">Next</button>
          </div>
        </div>

        <!-- Step 3: Target Language & Level -->
        <div class="onboarding-step" id="onboarding-step-3">
          <div class="onboarding-icon">🎓</div>
          <h2 data-i18n="onboarding.target_language.title">What would you like to learn?</h2>
          <p data-i18n="onboarding.target_language.subtitle">Choose your target language and current proficiency level.</p>
          <div class="onboarding-fields">
            <div class="onboarding-field">
              <label data-i18n="labels.course">Zielsprache</label>
              <select id="onboarding-target-lang" class="onboarding-select">
                <option value="ar" data-i18n="language_names.ar">العربية</option>
                <option value="en" data-i18n="language_names.en">English</option>
                <option value="es" data-i18n="language_names.es">Español</option>
                <option value="fr" data-i18n="language_names.fr">Français</option>
              </select>
            </div>
            <div class="onboarding-field">
              <label data-i18n="labels.level">Sprachniveau</label>
              <select id="onboarding-cefr" class="onboarding-select">
                <option value="A1" data-i18n="levels.cefr.a1">A1 - Beginner</option>
                <option value="A2" data-i18n="levels.cefr.a2">A2 - Elementary</option>
                <option value="B1" data-i18n="levels.cefr.b1">B1 - Intermediate</option>
                <option value="B2" data-i18n="levels.cefr.b2">B2 - Upper Intermediate</option>
                <option value="C1" data-i18n="levels.cefr.c1">C1 - Advanced</option>
                <option value="C2" data-i18n="levels.cefr.c2">C2 - Proficient</option>
              </select>
            </div>
          </div>
          <div class="onboarding-actions">
            <button class="secondary onboarding-back" data-i18n="onboarding.back">Back</button>
            <button class="primary onboarding-next" data-i18n="onboarding.next">Next</button>
          </div>
        </div>

        <!-- Step 4: Learning Focus -->
        <div class="onboarding-step" id="onboarding-step-4">
          <div class="onboarding-icon">🎯</div>
          <h2 data-i18n="onboarding.learning_focus.title">What's your learning focus?</h2>
          <p data-i18n="onboarding.learning_focus.subtitle">Choose topics that interest you most.</p>
          <div class="onboarding-options">
            <div class="onboarding-option" data-topic="daily life">
              <div class="option-icon">🏠</div>
              <div class="option-content">
                <h4 data-i18n="topics.daily_life">Alltagsleben</h4>
                <p data-i18n="onboarding.topics.daily_life.desc">Alltägliche Gespräche und Situationen</p>
              </div>
            </div>
            <div class="onboarding-option" data-topic="travel">
              <div class="option-icon">✈️</div>
              <div class="option-content">
                <h4 data-i18n="topics.travel">Reise</h4>
                <p data-i18n="onboarding.topics.travel.desc">Reisephrasen und kulturelle Einblicke</p>
              </div>
            </div>
            <div class="onboarding-option" data-topic="work">
              <div class="option-icon">💼</div>
              <div class="option-content">
                <h4 data-i18n="topics.work">Arbeit</h4>
                <p data-i18n="onboarding.topics.work.desc">Professionelle Kommunikation und Geschäft</p>
              </div>
            </div>
            <div class="onboarding-option" data-topic="food">
              <div class="option-icon">🍽️</div>
              <div class="option-content">
                <h4 data-i18n="topics.food">Essen</h4>
                <p data-i18n="onboarding.topics.food.desc">Kulinarisches Vokabular und Esskultur</p>
              </div>
            </div>
          </div>
          <div class="onboarding-actions">
            <button class="secondary onboarding-back" data-i18n="onboarding.back">Back</button>
            <button class="primary onboarding-finish" data-i18n="onboarding.finish">Finish Setup</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 data-i18n="settings.title">Settings</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="settings-content">
          <div class="settings-section">
            <h4 data-i18n="settings.display">Display</h4>
            <div class="field">
              <label for="settings-theme" data-i18n="settings.theme">Theme</label>
              <select id="settings-theme">
                <option value="light" data-i18n="settings.theme_light">Light</option>
                <option value="dark" data-i18n="settings.theme_dark">Dark</option>
                <option value="auto" data-i18n="settings.theme_auto">Auto</option>
              </select>
            </div>
            <div class="field">
              <label for="settings-native-lang" data-i18n="settings.native_language">Native Language</label>
              <select id="settings-native-lang">
                <option value="de" data-i18n="language_names.de">Deutsch</option>
                <option value="en" data-i18n="language_names.en">English</option>
              </select>
            </div>
          </div>
          
          <div class="settings-section">
            <h4 data-i18n="settings.progress">Progress</h4>
            <div class="progress-stats">
              <div class="stat-item">
                <span class="stat-label" data-i18n="settings.levels_completed">Total Levels Completed:</span>
                <span id="stat-levels-completed" class="stat-value">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label" data-i18n="settings.words_learned">Words Learned:</span>
                <span id="stat-words-learned" class="stat-value">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label" data-i18n="settings.current_streak">Current Streak:</span>
                <span id="stat-streak" class="stat-value">0 days</span>
              </div>
            </div>
          </div>
          
          <div class="settings-actions">
            <button id="save-settings" class="primary" style="width: 100%; padding: 12px; margin-bottom: 8px;" data-i18n="settings.save">Save Settings</button>
            <button id="reset-progress" class="secondary" style="width: 100%; padding: 12px;" data-i18n="settings.reset_progress">Reset Progress</button>
          </div>
          
          <div id="settings-error" class="error-message" style="display: none; color: var(--warn); font-size: 14px; margin-top: 12px;"></div>
          <div id="settings-success" class="success-message" style="display: none; color: var(--success); font-size: 14px; margin-top: 12px;"></div>
        </div>
      </div>
    </div>
  </div>

  <style>
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5) !important;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    /* Ensure modal backdrop is always visible regardless of theme */
    .theme-dark .modal,
    .theme-light .modal,
    .theme-auto .modal {
      background: rgba(0, 0, 0, 0.5) !important;
    }
    
    .modal-content {
      background: var(--card);
      border-radius: 12px;
      padding: 0;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      margin: 0;
      position: relative;
      transform: none;
      top: auto;
      left: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
    }
    
    .modal-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
      color: var(--fg);
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-secondary);
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
    }
    
    .modal-close:hover {
      background: var(--surface);
    }
    
    .modal-body {
      padding: 24px;
    }
    
    .modal-body .field {
      margin-bottom: 16px;
    }
    
    .modal-body label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--fg);
      font-size: 14px;
    }
    
    .modal-body input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      background: var(--surface);
      color: var(--fg);
      box-sizing: border-box;
    }
    
    .modal-body input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .success-message {
      color: var(--success);
      font-size: 14px;
      margin-top: 8px;
    }
    
    .settings-content {
      max-height: 70vh;
      overflow-y: auto;
    }
    
    .settings-section {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }
    
    .settings-section:last-child {
      border-bottom: none;
    }
    
    .settings-section h4 {
      margin: 0 0 16px 0;
      color: var(--text-primary);
      font-size: 16px;
      font-weight: 600;
    }
    
    .progress-stats {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: var(--bg-secondary);
      border-radius: 6px;
    }
    
    .stat-label {
      color: var(--text-secondary);
      font-size: 14px;
    }
    
    .stat-value {
      color: var(--text-primary);
      font-weight: 600;
      font-size: 14px;
    }
    
    .settings-actions {
      margin-top: 24px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    /* Dark Theme Styles */
    .theme-dark {
      --bg: #0f172a !important;
      --fg: #f8fafc !important;
      --muted: #94a3b8 !important;
      --accent: #3b82f6 !important;
      --card: #1e293b !important;
      --ok: #10b981 !important;
      --warn: #f59e0b !important;
      --ring: #1e40af !important;
      --success: #059669 !important;
      --reward: #d97706 !important;
      --progress: #0891b2 !important;
      --border: #334155 !important;
      --shadow: rgba(0, 0, 0, 0.3) !important;
      --surface: #334155 !important;
      --surface-hover: #475569 !important;
      --text-secondary: #cbd5e1 !important;
      --text-tertiary: #64748b !important;
    }
    .theme-dark html,
    .theme-dark body,
    .theme-dark main,
    .theme-dark section,
    .theme-dark article,
    .theme-dark aside,
    .theme-dark nav,
    .theme-dark footer,
    .theme-dark header {
      background: var(--bg) !important;
    }
    
    /* Ensure all UI components follow dark theme */
    .theme-dark .shell,
    .theme-dark .container,
    .theme-dark .wrapper,
    .theme-dark .content,
    .theme-dark .page {
      background: var(--bg) !important;
    }
    
    /* Ensure cards and modals have proper backgrounds */
    .theme-dark .card,
    .theme-dark .modal-content,
    .theme-dark .tooltip {
      background: var(--card) !important;
      color: var(--fg) !important;
    }
    
    /* Ensure modal backdrop remains dark overlay */
    .theme-dark .modal {
      background: rgba(0, 0, 0, 0.5) !important;
    }
    
    /* Ensure buttons and interactive elements are themed */
    .theme-dark button,
    .theme-dark .button,
    .theme-dark .btn {
      background: var(--surface) !important;
      color: var(--fg) !important;
      border-color: var(--border) !important;
    }
    
    .theme-dark button:hover,
    .theme-dark .button:hover,
    .theme-dark .btn:hover {
      background: var(--surface-hover) !important;
    }
    
    /* Ensure form elements are themed */
    .theme-dark input,
    .theme-dark select,
    .theme-dark textarea {
      background: var(--card) !important;
      color: var(--fg) !important;
      border-color: var(--border) !important;
    }
    
    /* Ensure pills and status indicators are themed */
    .theme-dark .pill {
      background: var(--surface) !important;
      color: var(--fg) !important;
    }
    
    .theme-dark .pill.ok {
      background: var(--ok) !important;
      color: white !important;
    }
    
    .theme-dark .pill.warn {
      background: var(--warn) !important;
      color: white !important;
    }
    
    .theme-dark .pill.error {
      background: var(--warn) !important;
      color: white !important;
    }
    
    /* Light Theme Styles - explicit override */
    .theme-light {
      --bg: #f8fafc !important;
      --fg: #0f172a !important;
      --muted: #64748b !important;
      --accent: #2563eb !important;
      --card: #ffffff !important;
      --ok: #059669 !important;
      --warn: #ea580c !important;
      --ring: #bfdbfe !important;
      --success: #16a34a !important;
      --reward: #f59e0b !important;
      --progress: #0891b2 !important;
      --border: #e2e8f0 !important;
      --shadow: rgba(15, 23, 42, 0.04) !important;
      --surface: #f1f5f9 !important;
      --surface-hover: #e2e8f0 !important;
      --text-secondary: #475569 !important;
      --text-tertiary: #94a3b8 !important;
    }
    
    /* Ensure all UI components follow light theme */
    .theme-light .shell,
    .theme-light .container,
    .theme-light .wrapper,
    .theme-light .content,
    .theme-light .page {
      background: var(--bg) !important;
    }
    
    /* Ensure cards and modals have proper backgrounds */
    .theme-light .card,
    .theme-light .modal-content,
    .theme-light .tooltip {
      background: var(--card) !important;
      color: var(--fg) !important;
    }
    
    /* Ensure modal backdrop remains dark overlay */
    .theme-light .modal {
      background: rgba(0, 0, 0, 0.5) !important;
    }
    
    /* Ensure buttons and interactive elements are themed */
    .theme-light button,
    .theme-light .button,
    .theme-light .btn {
      background: var(--surface) !important;
      color: var(--fg) !important;
      border-color: var(--border) !important;
    }
    
    .theme-light button:hover,
    .theme-light .button:hover,
    .theme-light .btn:hover {
      background: var(--surface-hover) !important;
    }
    
    /* Ensure form elements are themed */
    .theme-light input,
    .theme-light select,
    .theme-light textarea {
      background: var(--card) !important;
      color: var(--fg) !important;
      border-color: var(--border) !important;
    }
    
    /* Ensure pills and status indicators are themed */
    .theme-light .pill {
      background: var(--surface) !important;
      color: var(--fg) !important;
    }
    
    .theme-light .pill.ok {
      background: var(--ok) !important;
      color: white !important;
    }
    
    .theme-light .pill.warn {
      background: var(--warn) !important;
      color: white !important;
    }
    
    .theme-light .pill.error {
      background: var(--warn) !important;
      color: white !important;
    }
    
    /* Auto Theme - follows system preference */
    @media (prefers-color-scheme: dark) {
      .theme-auto {
        --bg: #0f172a !important;
        --fg: #f8fafc !important;
        --muted: #94a3b8 !important;
        --accent: #3b82f6 !important;
        --card: #1e293b !important;
        --ok: #10b981 !important;
        --warn: #f59e0b !important;
        --ring: #1e40af !important;
        --success: #059669 !important;
        --reward: #d97706 !important;
        --progress: #0891b2 !important;
        --border: #334155 !important;
        --shadow: rgba(0, 0, 0, 0.3) !important;
        --surface: #334155 !important;
        --surface-hover: #475569 !important;
        --text-secondary: #cbd5e1 !important;
        --text-tertiary: #64748b !important;
      }
      
      /* Ensure all UI components follow auto theme (dark mode) */
      .theme-auto .shell,
      .theme-auto .container,
      .theme-auto .wrapper,
      .theme-auto .content,
      .theme-auto .page {
        background: var(--bg) !important;
      }
      
      /* Ensure cards and modals have proper backgrounds */
      .theme-auto .card,
      .theme-auto .modal-content,
      .theme-auto .tooltip {
        background: var(--card) !important;
        color: var(--fg) !important;
      }
      
      /* Ensure modal backdrop remains dark overlay */
      .theme-auto .modal {
        background: rgba(0, 0, 0, 0.5) !important;
      }
      
      /* Ensure buttons and interactive elements are themed */
      .theme-auto button,
      .theme-auto .button,
      .theme-auto .btn {
        background: var(--surface) !important;
        color: var(--fg) !important;
        border-color: var(--border) !important;
      }
      
      .theme-auto button:hover,
      .theme-auto .button:hover,
      .theme-auto .btn:hover {
        background: var(--surface-hover) !important;
      }
      
      /* Ensure form elements are themed */
      .theme-auto input,
      .theme-auto select,
      .theme-auto textarea {
        background: var(--card) !important;
        color: var(--fg) !important;
        border-color: var(--border) !important;
      }
      
      /* Ensure pills and status indicators are themed */
      .theme-auto .pill {
        background: var(--surface) !important;
        color: var(--fg) !important;
      }
      
      .theme-auto .pill.ok {
        background: var(--ok) !important;
        color: white !important;
      }
      
      .theme-auto .pill.warn {
        background: var(--warn) !important;
        color: white !important;
      }
      
      .theme-auto .pill.error {
        background: var(--warn) !important;
        color: white !important;
      }
    }
    
    @media (prefers-color-scheme: light) {
      .theme-auto {
        --bg: #f8fafc !important;
        --fg: #0f172a !important;
        --muted: #64748b !important;
        --accent: #2563eb !important;
        --card: #ffffff !important;
        --ok: #059669 !important;
        --warn: #ea580c !important;
        --ring: #bfdbfe !important;
        --success: #16a34a !important;
        --reward: #f59e0b !important;
        --progress: #0891b2 !important;
        --border: #e2e8f0 !important;
        --shadow: rgba(15, 23, 42, 0.04) !important;
        --surface: #f1f5f9 !important;
        --surface-hover: #e2e8f0 !important;
        --text-secondary: #475569 !important;
        --text-tertiary: #94a3b8 !important;
      }
      
      /* Ensure all UI components follow auto theme (light mode) */
      .theme-auto .shell,
      .theme-auto .container,
      .theme-auto .wrapper,
      .theme-auto .content,
      .theme-auto .page {
        background: var(--bg) !important;
      }
      
      /* Ensure cards and modals have proper backgrounds */
      .theme-auto .card,
      .theme-auto .modal-content,
      .theme-auto .tooltip {
        background: var(--card) !important;
        color: var(--fg) !important;
      }
      
      /* Ensure modal backdrop remains dark overlay */
      .theme-auto .modal {
        background: rgba(0, 0, 0, 0.5) !important;
      }
      
      /* Ensure buttons and interactive elements are themed */
      .theme-auto button,
      .theme-auto .button,
      .theme-auto .btn {
        background: var(--surface) !important;
        color: var(--fg) !important;
        border-color: var(--border) !important;
      }
      
      .theme-auto button:hover,
      .theme-auto .button:hover,
      .theme-auto .btn:hover {
        background: var(--surface-hover) !important;
      }
      
      /* Ensure form elements are themed */
      .theme-auto input,
      .theme-auto select,
      .theme-auto textarea {
        background: var(--card) !important;
        color: var(--fg) !important;
        border-color: var(--border) !important;
      }
      
      /* Ensure pills and status indicators are themed */
      .theme-auto .pill {
        background: var(--surface) !important;
        color: var(--fg) !important;
      }
      
      .theme-auto .pill.ok {
        background: var(--ok) !important;
        color: white !important;
      }
      
      .theme-auto .pill.warn {
        background: var(--warn) !important;
        color: white !important;
      }
      
      .theme-auto .pill.error {
        background: var(--warn) !important;
        color: white !important;
      }
    }
  </style>

    <!-- Bug Report Button (only visible for logged-in users) -->
    <div id="bug-report-button" class="bug-report-button" onclick="openBugReportModal()" title="Bug melden" style="display: none;">
        🐛
    </div>

    <!-- Bug Report Modal -->
    <div id="bug-report-modal" class="bug-report-modal">
        <div class="bug-report-content">
            <div class="bug-report-header">
                <h2>🐛 Bug melden</h2>
                <span class="bug-report-close" onclick="closeBugReportModal()">&times;</span>
            </div>
            
            <form id="bug-report-form" onsubmit="submitBugReport(event)">
                <div class="bug-report-field">
                    <label for="bug-title">Titel des Problems *</label>
                    <input type="text" id="bug-title" name="title" required placeholder="Kurze Beschreibung des Problems">
                </div>
                
                <div class="bug-report-field">
                    <label for="bug-description">Detaillierte Beschreibung *</label>
                    <textarea id="bug-description" name="description" required rows="4" placeholder="Beschreiben Sie das Problem so detailliert wie möglich..."></textarea>
                </div>
                
                <div class="bug-report-field">
                    <label for="bug-steps">Schritte zur Reproduktion</label>
                    <textarea id="bug-steps" name="steps_to_reproduce" rows="3" placeholder="1. Gehen Sie zu...&#10;2. Klicken Sie auf...&#10;3. Das Problem tritt auf..."></textarea>
                </div>
                
                <div class="bug-report-field">
                    <label for="bug-expected">Erwartetes Verhalten</label>
                    <textarea id="bug-expected" name="expected_behavior" rows="2" placeholder="Was sollte normalerweise passieren?"></textarea>
                </div>
                
                <div class="bug-report-field">
                    <label for="bug-actual">Tatsächliches Verhalten</label>
                    <textarea id="bug-actual" name="actual_behavior" rows="2" placeholder="Was passiert stattdessen?"></textarea>
                </div>
                
                <div class="bug-report-field">
                    <label for="bug-severity">Schweregrad</label>
                    <select id="bug-severity" name="severity">
                        <option value="low">Niedrig - Kleines Problem</option>
                        <option value="medium" selected>Mittel - Normales Problem</option>
                        <option value="high">Hoch - Wichtiges Problem</option>
                        <option value="critical">Kritisch - App nicht nutzbar</option>
                    </select>
                </div>
                
                <div class="bug-report-actions">
                    <button type="button" onclick="closeBugReportModal()" class="bug-report-cancel">Abbrechen</button>
                    <button type="submit" class="bug-report-submit">Bug melden</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bug Report Styles -->
    <style>
        .bug-report-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            border: 3px solid white;
        }
        
        .bug-report-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }
        
        .bug-report-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .bug-report-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: bugReportSlideIn 0.3s ease-out;
        }
        
        @keyframes bugReportSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .bug-report-header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 20px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .bug-report-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }
        
        .bug-report-close {
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .bug-report-close:hover {
            transform: scale(1.2);
        }
        
        .bug-report-field {
            margin: 20px 30px;
        }
        
        .bug-report-field label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .bug-report-field input,
        .bug-report-field textarea,
        .bug-report-field select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        .bug-report-field input:focus,
        .bug-report-field textarea:focus,
        .bug-report-field select:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }
        
        .bug-report-field textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .bug-report-actions {
            padding: 20px 30px 30px;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }
        
        .bug-report-cancel,
        .bug-report-submit {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .bug-report-cancel {
            background-color: #f8f9fa;
            color: #6c757d;
            border: 2px solid #e9ecef;
        }
        
        .bug-report-cancel:hover {
            background-color: #e9ecef;
        }
        
        .bug-report-submit {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        
        .bug-report-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }
        
        .bug-report-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        @media (max-width: 768px) {
            .bug-report-content {
                margin: 10% auto;
                width: 95%;
            }
            
            .bug-report-field {
                margin: 15px 20px;
            }
            
            .bug-report-actions {
                padding: 15px 20px 20px;
                flex-direction: column;
            }
            
            .bug-report-cancel,
            .bug-report-submit {
                width: 100%;
            }
        }
    </style>

    <!-- Bug Report JavaScript -->
    <script>
        function openBugReportModal() {
            // Check if user is logged in
            if (!isUserAuthenticated()) {
                alert('Sie müssen eingeloggt sein, um einen Bug zu melden.');
                return;
            }
            
            document.getElementById('bug-report-modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        function closeBugReportModal() {
            document.getElementById('bug-report-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
            document.getElementById('bug-report-form').reset();
        }
        
        function submitBugReport(event) {
            event.preventDefault();
            
            if (!isUserAuthenticated()) {
                alert('Sie müssen eingeloggt sein, um einen Bug zu melden.');
                return;
            }
            
            const currentUser = getCurrentUser();
            
            const form = event.target;
            const formData = new FormData(form);
            
            // Collect additional system information
            const bugData = {
                user_id: currentUser.id,
                title: formData.get('title'),
                description: formData.get('description'),
                steps_to_reproduce: formData.get('steps_to_reproduce'),
                expected_behavior: formData.get('expected_behavior'),
                actual_behavior: formData.get('actual_behavior'),
                severity: formData.get('severity'),
                browser_info: navigator.userAgent,
                device_info: `${navigator.platform} - ${screen.width}x${screen.height}`,
                current_url: window.location.href,
                language: currentUser.language || 'de',
                level: getCurrentLevel() || ''
            };
            
            // Disable submit button
            const submitBtn = form.querySelector('.bug-report-submit');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Wird gesendet...';
            
            // Submit bug report
            fetch('/api/bug-report', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(bugData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert('✅ Bug-Report erfolgreich gesendet! Vielen Dank für Ihr Feedback.');
                    closeBugReportModal();
                } else {
                    alert('❌ Fehler beim Senden des Bug-Reports: ' + (data.error || 'Unbekannter Fehler'));
                }
            })
            .catch(error => {
                console.error('Error submitting bug report:', error);
                alert('❌ Fehler beim Senden des Bug-Reports. Bitte versuchen Sie es später erneut.');
            })
            .finally(() => {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Bug melden';
            });
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('bug-report-modal');
            if (event.target === modal) {
                closeBugReportModal();
            }
        }
        
        // Helper function to get current level (you may need to adjust this based on your app structure)
        function getCurrentLevel() {
            // This should return the current level number if available
            // You may need to adjust this based on how your app tracks the current level
            return window.currentLevel || '';
        }
        
        // Helper function to get current user (integrated with AuthManager)
        function getCurrentUser() {
            // Try to get from AuthManager if available
            if (window.authManager && window.authManager.currentUser) {
                return window.authManager.currentUser;
            }
            
            // Try to get from global window object
            if (window.currentUser) {
                return window.currentUser;
            }
            
            // Try to get from localStorage
            const storedUser = localStorage.getItem('currentUser');
            if (storedUser) {
                try {
                    return JSON.parse(storedUser);
                } catch (e) {
                    console.error('Error parsing stored user:', e);
                }
            }
            
            // Try to get from sessionStorage
            const sessionUser = sessionStorage.getItem('currentUser');
            if (sessionUser) {
                try {
                    return JSON.parse(sessionUser);
                } catch (e) {
                    console.error('Error parsing session user:', e);
                }
            }
            
            // For testing purposes, return a default user
            // In production, this should be handled by your authentication system
            return {
                id: 3,
                username: 'testuser',
                language: 'de',
                native_language: 'en'
            };
        }
        
        // Helper function to check if user is authenticated
        function isUserAuthenticated() {
            if (window.authManager) {
                return window.authManager.isAuthenticated();
            }
            
            const user = getCurrentUser();
            return user && user.id;
        }
        
        // Function to show/hide bug report button based on auth status
        function updateBugReportButtonVisibility() {
            const bugButton = document.getElementById('bug-report-button');
            if (bugButton) {
                if (isUserAuthenticated()) {
                    bugButton.style.display = 'flex';
                } else {
                    bugButton.style.display = 'none';
                }
            }
        }
        
        // Check auth status periodically and update button visibility
        function checkAuthStatus() {
            updateBugReportButtonVisibility();
        }
        
        // Run check when page loads and periodically
        document.addEventListener('DOMContentLoaded', function() {
            updateBugReportButtonVisibility();
            // Check every 2 seconds
            setInterval(checkAuthStatus, 2000);
            
            // Initialize tab functionality - wait a bit for modules to load
            setTimeout(() => {
                initializeTabs();
                console.log('✅ Tabs initialized, showTab available:', typeof window.showTab);
            }, 100);
        });
        
        
        // Function to show/hide main navigation based on auth status
        function updateMainNavigationVisibility() {
            const mainNav = document.getElementById('main-navigation');
            if (mainNav) {
                // Always show navigation now that it's the main navigation
                mainNav.style.display = 'block';
            }
        }
        
        // Update main navigation visibility
        function checkMainNavigationStatus() {
            updateMainNavigationVisibility();
        }
        
        // Run main navigation check when page loads and periodically
        document.addEventListener('DOMContentLoaded', function() {
            updateMainNavigationVisibility();
            // Check every 2 seconds
            setInterval(checkMainNavigationStatus, 2000);
        });
        
        // Function to update library statistics and progress stats
        function updateLibraryStats() {
            // Derive counts from header stats if available
            const latestCounts = (window.headerStats && window.headerStats.latestCounts) || {};
            const activeWords = Number(latestCounts.activeWords || 0);
            const memorizedWords = Number(latestCounts.memorizedWords || 0);
            
            // Optional legacy stats (currently unused placeholders)
            const totalCoursesEl = document.getElementById('total-courses');
            const completedLevelsEl = document.getElementById('completed-levels');
            const wordsLearnedEl = document.getElementById('words-learned');
            
            if (totalCoursesEl && totalCoursesEl.dataset.static !== 'true') totalCoursesEl.textContent = '12';
            if (completedLevelsEl && completedLevelsEl.dataset.static !== 'true') completedLevelsEl.textContent = '0';
            if (wordsLearnedEl && wordsLearnedEl.dataset.static !== 'true') wordsLearnedEl.textContent = '0';
            
            // Update progress stats in library header
            const totalWordsCountEl = document.getElementById('total-words-count');
            const memorizedWordsCountEl = document.getElementById('memorized-words-count');
            
            if (totalWordsCountEl) totalWordsCountEl.textContent = activeWords.toLocaleString();
            if (memorizedWordsCountEl) memorizedWordsCountEl.textContent = memorizedWords.toLocaleString();
        }
        
        // Update library stats when library tab becomes active
        function onLibraryTabActivated() {
            updateLibraryStats();
            // Show custom level groups in library
            if (typeof window.showCustomLevelGroupsInLibrary === 'function') {
                window.showCustomLevelGroupsInLibrary();
            }
        }
        
        // Make functions globally available
        window.onLibraryTabActivated = onLibraryTabActivated;
        window.loadSettings = loadSettings;
        
        document.addEventListener('headerStatsUpdated', updateLibraryStats);
        
        // Initialize custom level groups when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit for all scripts to load
            setTimeout(() => {
                if (typeof window.showCustomLevelGroupsInLibrary === 'function') {
                    window.showCustomLevelGroupsInLibrary();
                }
            }, 1000);
        });
        
        // Enhanced tab functionality with callbacks
        function initializeTabs() {
            const navTabs = document.querySelectorAll('.nav-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            navTabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetTab = tab.getAttribute('data-tab');
                    
                    // Use the global showTab function for consistent behavior
                    if (typeof window.showTab === 'function') {
                        window.showTab(targetTab);
                    } else {
                        // Fallback to local implementation
                        // Remove active class from all tabs and contents
                        navTabs.forEach(t => t.classList.remove('active'));
                        tabContents.forEach(content => content.classList.remove('active'));
                        
                        // Add active class to clicked tab and corresponding content
                        tab.classList.add('active');
                        const targetContent = document.getElementById(targetTab + '-tab');
                        
                        if (targetContent) {
                            targetContent.classList.add('active');
                            
                            // Call specific tab activation functions
                            if (targetTab === 'library') {
                                onLibraryTabActivated();
                                // Show custom level groups in library
                                if (typeof window.showCustomLevelGroupsInLibrary === 'function') {
                                    window.showCustomLevelGroupsInLibrary();
                                }
                            } else if (targetTab === 'browse') {
                                // Initialize marketplace for browse tab
                                if (typeof window.initMarketplace === 'function') {
                                    window.initMarketplace();
                                }
                            } else if (targetTab === 'courses') {
                                // Load course cards for courses tab
                                if (typeof window.loadCourseCards === 'function') {
                                    window.loadCourseCards();
                                }
                            } else if (targetTab === 'settings') {
                                loadSettings();
                            }
                        }
                    }
                });
            });
        }
        
        // Settings functionality
        function loadSettings() {
            // Load current user settings
            const user = getCurrentUser();
            if (user) {
                // Set native language - use backend value if available, otherwise user value
                const nativeLangSelect = document.getElementById('settings-native-lang');
                if (nativeLangSelect) {
                    // Check if we already have a backend value set
                    const currentValue = nativeLangSelect.value;
                    const backendValue = localStorage.getItem('siluma_native');
                    const userValue = user.native_language || 'en';
                    
                    // Use backend value if available and different from current, otherwise use user value
                    const valueToSet = (backendValue && backendValue !== currentValue) ? backendValue : userValue;
                    nativeLangSelect.value = valueToSet;
                    console.log('🔍 Debug: Setting dropdown value to:', valueToSet, '(backend:', backendValue, 'user:', userValue, 'current:', currentValue, ')');
                }
                
                // Load other settings from localStorage
                const autoPlay = localStorage.getItem('user_auto_play') !== 'false';
                const soundEffects = localStorage.getItem('user_sound_effects') !== 'false';
                
                const autoPlayCheckbox = document.getElementById('settings-auto-play');
                const soundEffectsCheckbox = document.getElementById('settings-sound-effects');
                
                if (autoPlayCheckbox) autoPlayCheckbox.checked = autoPlay;
                if (soundEffectsCheckbox) soundEffectsCheckbox.checked = soundEffects;
            }
        }
        
        // Debounced save function to avoid excessive saves
        let saveSettingsTimeout;
        let isSaving = false;
        
        function saveSettings() {
            const user = getCurrentUser();
            if (!user) return;
            
            // Show auto-save indicator
            showAutoSaveIndicator();
            
            // Clear existing timeout
            if (saveSettingsTimeout) {
                clearTimeout(saveSettingsTimeout);
            }
            
            // Debounce the save operation
            saveSettingsTimeout = setTimeout(async () => {
                if (isSaving) return;
                isSaving = true;
                
                try {
                    // Get settings values
                    const nativeLang = document.getElementById('settings-native-lang')?.value;
                    const autoPlay = document.getElementById('settings-auto-play')?.checked;
                    const soundEffects = document.getElementById('settings-sound-effects')?.checked;
                    
                    // Save to localStorage
                    if (nativeLang) localStorage.setItem('user_native_language', nativeLang);
                    if (autoPlay !== undefined) localStorage.setItem('user_auto_play', autoPlay);
                    if (soundEffects !== undefined) localStorage.setItem('user_sound_effects', soundEffects);
                    
                    // Update user object
                    user.native_language = nativeLang;
                    
                    // Apply native language change with full functionality
                    if (nativeLang) {
                        await applyNativeLanguageChange(nativeLang);
                    }
                    
                    // Show success feedback
                    showAutoSaveSuccess();
                } catch (error) {
                    console.error('Error saving settings:', error);
                    showAutoSaveError();
                } finally {
                    isSaving = false;
                }
            }, 500); // 500ms delay
        }
        
        function showAutoSaveIndicator() {
            const indicator = document.getElementById('settings-auto-save-indicator');
            if (indicator) {
                indicator.style.display = 'flex';
                indicator.classList.add('show');
            }
        }
        
        function showAutoSaveSuccess() {
            const indicator = document.getElementById('settings-auto-save-indicator');
            if (indicator) {
                indicator.innerHTML = '<span class="auto-save-icon">✅</span><span class="auto-save-text">Einstellungen gespeichert</span>';
                indicator.style.background = 'var(--success)';
                indicator.style.color = 'white';
                indicator.style.borderColor = 'var(--success)';
                
                // Hide after 2 seconds
                setTimeout(() => {
                    indicator.classList.remove('show');
                    setTimeout(() => {
                        indicator.style.display = 'none';
                        // Reset to original state
                        indicator.innerHTML = '<span class="auto-save-icon">💾</span><span class="auto-save-text">Einstellungen werden automatisch gespeichert</span>';
                        indicator.style.background = 'var(--surface)';
                        indicator.style.color = 'var(--text-secondary)';
                        indicator.style.borderColor = 'var(--border)';
                    }, 300);
                }, 2000);
            }
        }
        
        function showAutoSaveError() {
            const indicator = document.getElementById('settings-auto-save-indicator');
            if (indicator) {
                indicator.innerHTML = '<span class="auto-save-icon">❌</span><span class="auto-save-text">Fehler beim Speichern</span>';
                indicator.style.background = 'var(--warn)';
                indicator.style.color = 'white';
                indicator.style.borderColor = 'var(--warn)';
                
                // Hide after 3 seconds
                setTimeout(() => {
                    indicator.classList.remove('show');
                    setTimeout(() => {
                        indicator.style.display = 'none';
                        // Reset to original state
                        indicator.innerHTML = '<span class="auto-save-icon">💾</span><span class="auto-save-text">Einstellungen werden automatisch gespeichert</span>';
                        indicator.style.background = 'var(--surface)';
                        indicator.style.color = 'var(--text-secondary)';
                        indicator.style.borderColor = 'var(--border)';
                    }, 300);
                }, 3000);
            }
        }
        
        // Helper function to update native language dropdown with retry
        function updateNativeLanguageDropdown(nativeLang, retryCount = 0) {
            // Try multiple selectors for the native language dropdown
            const selectors = ['#settings-native-lang', '#native-lang', 'select[name="native_language"]'];
            let nativeLangSelect = null;
            
            for (const selector of selectors) {
                nativeLangSelect = document.querySelector(selector);
                if (nativeLangSelect) break;
            }
            
            if (nativeLangSelect) {
                console.log('🔍 Debug: Found dropdown, current value:', nativeLangSelect.value, 'setting to:', nativeLang);
                nativeLangSelect.value = nativeLang;
                console.log('🔍 Debug: After setting, dropdown value is:', nativeLangSelect.value);
                console.log('🌍 Updated native language dropdown to:', nativeLang);
                
                // Trigger change event to ensure any listeners are notified
                nativeLangSelect.dispatchEvent(new Event('change', { bubbles: true }));
            } else if (retryCount < 10) {
                // Retry after 200ms if dropdown not found
                setTimeout(() => updateNativeLanguageDropdown(nativeLang, retryCount + 1), 200);
            } else {
                console.log('ℹ️ Native language dropdown not found - may be in different tab or not yet loaded');
            }
        }

        // Load native language from backend on app start (for authenticated users)
        async function loadNativeLanguageFromBackend() {
            // Check if user is authenticated before making API call
            if (window.authManager && window.authManager.isAuthenticated()) {
                try {
                    // Get auth headers from authManager
                    const authHeaders = window.authManager.getAuthHeaders ? window.authManager.getAuthHeaders() : {};
                    console.log('🔍 Debug: Auth headers:', authHeaders);
                    
                    const response = await fetch('/api/user/settings', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            ...authHeaders
                        }
                    });
                    
                    console.log('🔍 Debug: Response status:', response.status);
                    
                    // Check if response is successful
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success && data.settings && data.settings.native_language) {
                            const backendNativeLang = data.settings.native_language;
                            const localNativeLang = localStorage.getItem('siluma_native') || 'de';
                            
                            // If backend has different value, use backend value
                            if (backendNativeLang !== localNativeLang) {
                                console.log('🔄 Backend native language differs from localStorage:', backendNativeLang, 'vs', localNativeLang);
                                localStorage.setItem('siluma_native', backendNativeLang);
                            }
                            
                            // Update dropdown if it exists
                            updateNativeLanguageDropdown(backendNativeLang);
                            
                            return backendNativeLang;
                        }
                    } else if (response.status === 401) {
                        console.log('🔒 User not authenticated, using localStorage for native language');
                    } else {
                        console.warn('⚠️ Failed to load backend settings, status:', response.status);
                    }
                } catch (error) {
                    console.warn('⚠️ Failed to load backend settings, using localStorage:', error);
                }
            } else {
                console.log('🔒 User not authenticated, using localStorage for native language');
            }
            return localStorage.getItem('siluma_native') || 'de';
        }

        // Apply native language change with full functionality (from old settings)
        async function applyNativeLanguageChange(nativeLang) {
            console.log('🌍 Applying native language change:', nativeLang);
            
            // Update the native language in localStorage
            localStorage.setItem('siluma_native', nativeLang);
            
            // Send native language to backend if user is authenticated
            if (window.authManager && window.authManager.isAuthenticated()) {
                try {
                    const response = await fetch('/api/user/settings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            ...window.authManager.getAuthHeaders()
                        },
                        body: JSON.stringify({
                            native_language: nativeLang
                        })
                    });
                    
                    if (response.ok) {
                        console.log('🌍 Native language updated in backend:', nativeLang);
                    } else {
                        console.warn('⚠️ Failed to update native language in backend');
                    }
                } catch (error) {
                    console.error('❌ Error updating native language in backend:', error);
                }
            }
            
            // Trigger localization update and wait for it to complete
            if (window.setLocale) {
                window.setLocale(nativeLang);
                
                // Listen for translations to be loaded
                const handleTranslationsLoaded = async (event) => {
                    console.log('🌍 Translations loaded from:', event.detail.source, 'for locale:', event.detail.locale);
                    
                    // Apply i18n updates
                    if (window.applyI18n) {
                        window.applyI18n();
                    }
                    
                    // Apply select translations
                    if (window.applySelectTranslations) {
                        window.applySelectTranslations();
                    }
                    
                    // Update course language dropdown if it exists
                    if (window.updateCourseLanguageDropdown) {
                        window.updateCourseLanguageDropdown(nativeLang);
                    }
                    
                    // Force refresh of level states to update language-dependent content
                    if (window.refreshLevelStates) {
                        window.refreshLevelStates();
                    }
                    
                    // Update level group names for new language
                    if (window.updateLevelGroupNames) {
                        try {
                            window.updateLevelGroupNames();
                            console.log('🌍 Level group names updated for new language');
                        } catch (error) {
                            console.warn('⚠️ Failed to update level group names:', error);
                        }
                    }
                    
                    // Update all UI elements that might need language updates
                    updateAllUIElements();
                    
                    // Words tab removed - no longer part of the app
                    console.log('🌍 Native language changed to:', nativeLang);
                    
                    // Don't force navigation after language change
                    // This was causing issues when users tried to switch tabs
                    // The user should stay on their current tab when changing language
                    console.log('🌍 Language change complete - staying on current tab');
                    
                    console.log('🌍 Complete localization update finished for:', nativeLang);
                    
                    // Remove the event listener
                    window.removeEventListener('translationsLoaded', handleTranslationsLoaded);
                };
                
                // Add event listener for when translations are loaded
                window.addEventListener('translationsLoaded', handleTranslationsLoaded);
                
                // Fallback timeout in case the event doesn't fire
                setTimeout(() => {
                    window.removeEventListener('translationsLoaded', handleTranslationsLoaded);
                    console.log('🌍 Fallback: Applying translations after timeout');
                    
                    // Apply i18n updates
                    if (window.applyI18n) {
                        window.applyI18n();
                    }
                    
                    // Apply select translations
                    if (window.applySelectTranslations) {
                        window.applySelectTranslations();
                    }
                    
                    // Update all UI elements
                    updateAllUIElements();
                }, 1000); // Fallback after 1 second
            }
        }
        
        // Update all UI elements that might need language updates
        function updateAllUIElements() {
            try {
                // Update navigation buttons
                const navButtons = document.querySelectorAll('.nav button');
                navButtons.forEach(btn => {
                    if (btn.id === 'nav-alphabet') {
                        btn.textContent = window.t ? window.t('navigation.alphabet', 'Alphabet') : 'Alphabet';
                    } else if (btn.id === 'show-words') {
                        btn.textContent = window.t ? window.t('navigation.words', 'Words') : 'Words';
                    }
                });
                
                // Update course configuration labels
                const courseLabel = document.querySelector('label[for="target-lang"]');
                if (courseLabel) {
                    courseLabel.textContent = window.t ? window.t('labels.target_language', 'Target Language') : 'Target Language';
                }
                
                // Update CEFR level labels
                const cefrLabel = document.querySelector('label[for="cefr"]');
                if (cefrLabel) {
                    cefrLabel.textContent = window.t ? window.t('labels.level', 'Level') : 'Level';
                }
                
                // Update topic labels
                const topicLabel = document.querySelector('label[for="topic"]');
                if (topicLabel) {
                    topicLabel.textContent = window.t ? window.t('labels.motivation', 'Motivation') : 'Motivation';
                }
                
                // Update settings labels (exclude course tab label)
                const settingsLabels = document.querySelectorAll('[data-i18n]:not(.course-tab .tab-label)');
                settingsLabels.forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    if (key && window.t) {
                        const translation = window.t(key);
                        if (translation && translation !== key) {
                            element.textContent = translation;
                        }
                    }
                });
                
                // Update course tab name with new localized language
                const targetLangSelect = document.getElementById('target-lang');
                if (targetLangSelect && targetLangSelect.value) {
                    console.log('🌍 Updating course tab name for language change:', targetLangSelect.value);
                    updateCourseTabName(targetLangSelect.value);
                }
                
                console.log('🌍 UI elements updated for new native language');
            } catch (error) {
                console.error('❌ Error updating UI elements:', error);
            }
        }
        
        // Enhanced tab switching functionality
        function switchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            const selectedContent = document.getElementById(`${tabName}-tab`);
            if (selectedContent) {
                selectedContent.classList.add('active');
            }
            
            // Add active class to selected tab
            const selectedTab = document.querySelector(`[data-tab="${tabName}"]`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Handle settings tab specific functionality
            if (tabName === 'settings') {
                loadSettings();
            }
        }
        
        // Event listeners for settings
        document.addEventListener('DOMContentLoaded', function() {
            // Settings form change listeners - auto-save on any change
            const settingsInputs = document.querySelectorAll('#settings-tab input, #settings-tab select');
            settingsInputs.forEach(input => {
                // Listen to multiple events for immediate feedback
                input.addEventListener('change', saveSettings);
                input.addEventListener('input', saveSettings);
                input.addEventListener('blur', saveSettings);
            });
            
        // Event listeners for clickable stats
        document.addEventListener('click', function(event) {
          const statCard = event.target.closest('.clickable-stat');
          if (statCard) {
            const action = statCard.getAttribute('data-action');
            if (action === 'show-all-words') {
              // TODO: Implement show all words functionality
              console.log('Show all words clicked');
            } else if (action === 'show-learned-words') {
              // TODO: Implement show learned words functionality
              console.log('Show learned words clicked');
            }
          }
        });
        
        // Logout tooltip functionality
        const userInfoTrigger = document.getElementById('user-info-tooltip-trigger');
        const loginInfoTrigger = document.getElementById('login-info-trigger');
        const logoutTooltip = document.getElementById('logout-tooltip');
        const logoutBtnTooltip = document.getElementById('logout-btn-tooltip');
        
        // Login dropdown functionality
        const loginDropdown = document.getElementById('login-dropdown');
        const loginDropdownBtn = document.getElementById('login-dropdown-btn');
        const registerDropdownBtn = document.getElementById('register-dropdown-btn');
        const settingsDropdownBtn = document.getElementById('settings-dropdown-btn');
        const settingsBtnTooltip = document.getElementById('settings-btn-tooltip');
        
        if (userInfoTrigger && logoutTooltip) {
          userInfoTrigger.addEventListener('click', function(e) {
            e.stopPropagation();
            const rect = userInfoTrigger.getBoundingClientRect();
            
            // Position tooltip directly below the user info
            const left = rect.left;
            const top = rect.bottom + 8;
            
            logoutTooltip.style.display = 'block';
            logoutTooltip.style.left = left + 'px';
            logoutTooltip.style.top = top + 'px';
            logoutTooltip.style.transform = 'none';
            logoutTooltip.style.position = 'fixed';
            logoutTooltip.style.zIndex = '1000';
          });
          
          // Hide tooltip when clicking outside
          document.addEventListener('click', function(e) {
            if (!userInfoTrigger.contains(e.target) && !logoutTooltip.contains(e.target)) {
              logoutTooltip.style.display = 'none';
            }
          });
        }
        
        // Login functionality
        if (loginInfoTrigger && loginDropdown) {
          // Get the parent button element
          const loginButton = loginInfoTrigger.closest('button.user-tab');
          
          if (loginButton) {
            loginButton.addEventListener('click', function(e) {
              e.preventDefault(); // Prevent button default behavior
              e.stopPropagation();
              const rect = loginButton.getBoundingClientRect();
              
              // Position dropdown directly below the login button
              const left = rect.left;
              const top = rect.bottom + 8;
              
              loginDropdown.style.display = 'block';
              loginDropdown.style.left = left + 'px';
              loginDropdown.style.top = top + 'px';
              loginDropdown.style.transform = 'none';
              loginDropdown.style.position = 'fixed';
              loginDropdown.style.zIndex = '1000';
            });
          }
          
          // Also add click listener to the inner trigger for better UX
          loginInfoTrigger.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const rect = loginButton.getBoundingClientRect();
            
            // Position dropdown directly below the login button
            const left = rect.left;
            const top = rect.bottom + 8;
            
            loginDropdown.style.display = 'block';
            loginDropdown.style.left = left + 'px';
            loginDropdown.style.top = top + 'px';
            loginDropdown.style.transform = 'none';
            loginDropdown.style.position = 'fixed';
            loginDropdown.style.zIndex = '1000';
          });
          
          // Hide dropdown when clicking outside
          document.addEventListener('click', function(e) {
            if (!loginButton.contains(e.target) && !loginDropdown.contains(e.target)) {
              loginDropdown.style.display = 'none';
            }
          });
        }
        
        // Dropdown button functionality
        if (loginDropdownBtn) {
          loginDropdownBtn.addEventListener('click', function() {
            // Open login modal directly - handled by AuthManager
            if (window.authManager) {
              window.authManager.showLoginModal();
            }
            loginDropdown.style.display = 'none';
          });
        }
        
        if (registerDropdownBtn) {
          registerDropdownBtn.addEventListener('click', function() {
            // Open register modal directly - handled by AuthManager
            if (window.authManager) {
              window.authManager.showRegisterModal();
            }
            loginDropdown.style.display = 'none';
          });
        }
        
        // Settings functionality
        if (settingsDropdownBtn) {
          settingsDropdownBtn.addEventListener('click', function() {
            // Open settings tab/page like the original tab
            if (typeof window.showTab === 'function') {
              window.showTab('settings');
            }
            loginDropdown.style.display = 'none';
          });
        }
        
        if (settingsBtnTooltip) {
          settingsBtnTooltip.addEventListener('click', function() {
            // Open settings tab/page like the original tab
            if (typeof window.showTab === 'function') {
              window.showTab('settings');
            }
            logoutTooltip.style.display = 'none';
          });
        }
        
        // Course tab functionality
        const courseTabTrigger = document.getElementById('course-tab-trigger');
        if (courseTabTrigger) {
          courseTabTrigger.addEventListener('click', function(e) {
            // If clicking on the dropdown, let it work normally
            if (e.target.closest('.course-selector')) {
              return;
            }
            
            // If clicking on the tab area (not dropdown), open courses page
            e.preventDefault();
            e.stopPropagation();
            
            if (typeof window.showTab === 'function') {
              window.showTab('courses');
            }
          });
        }
        
        // Course cards functionality
        window.loadCourseCards = function() {
          console.log('🌍 loadCourseCards called');
          const coursesGrid = document.getElementById('courses-grid');
          const coursesLoading = document.getElementById('courses-loading');
          const coursesError = document.getElementById('courses-error');
          
          if (!coursesGrid || !coursesLoading || !coursesError) {
            console.error('❌ Courses tab elements not found!', {coursesGrid, coursesLoading, coursesError});
            return;
          }
          
          // Show loading state
          coursesGrid.style.display = 'none';
          coursesError.style.display = 'none';
          coursesLoading.style.display = 'block';
          
          // Get current native language
          const currentNativeLang = window.currentLocale || 'en';
          
          // Load available courses using the same logic as the dropdown
          console.log('📡 Fetching courses for native lang:', currentNativeLang);
          fetch(`/api/available-courses?native_lang=${currentNativeLang}`)
            .then(response => response.json())
            .then(data => {
              console.log('📡 Courses API response:', data);
              if (data.success && data.languages) {
                // Store course data globally
                window.courseData = {};
                data.languages.forEach(lang => {
                  window.courseData[lang.code] = lang;
                });
                
                console.log(`✅ Rendering ${data.languages.length} course cards`);
                renderCourseCards(data.languages);
                coursesLoading.style.display = 'none';
                coursesGrid.style.display = 'grid';
              } else {
                throw new Error(data.error || 'Failed to load courses');
              }
            })
            .catch(error => {
              console.error('Error loading courses:', error);
              coursesLoading.style.display = 'none';
              coursesError.style.display = 'block';
            });
        }
        
        function renderCourseCards(languages) {
          const coursesGrid = document.getElementById('courses-grid');
          if (!coursesGrid) return;
          
          coursesGrid.innerHTML = '';
          
          languages.forEach(lang => {
            const courseCard = createCourseCard(lang);
            coursesGrid.appendChild(courseCard);
          });
        }
        
        function createCourseCard(lang) {
          const card = document.createElement('div');
          card.className = 'course-card';
          card.setAttribute('data-lang-code', lang.code);
          
          // Get flag emoji for the language
          const flag = getFlagForLanguage(lang.code);
          
          card.innerHTML = `
            <div class="course-card-header">
              <div class="course-flag">${flag}</div>
              <div class="course-info">
                <h3 class="course-name">${lang.name}</h3>
                <p class="course-code">${lang.code.toUpperCase()}</p>
              </div>
            </div>
            <div class="course-actions">
              <button class="course-btn primary" onclick="selectCourse('${lang.code}')">
                Kurs auswählen
              </button>
            </div>
          `;
          
          return card;
        }
        
        function getFlagForLanguage(code) {
          const flagMap = {
            'en': '🇺🇸',
            'es': '🇪🇸',
            'fr': '🇫🇷',
            'de': '🇩🇪',
            'it': '🇮🇹',
            'pt': '🇵🇹',
            'ru': '🇷🇺',
            'zh': '🇨🇳',
            'ja': '🇯🇵',
            'ko': '🇰🇷',
            'ar': '🇸🇦',
            'hi': '🇮🇳',
            'th': '🇹🇭',
            'vi': '🇻🇳',
            'tr': '🇹🇷',
            'pl': '🇵🇱',
            'nl': '🇳🇱',
            'sv': '🇸🇪',
            'no': '🇳🇴',
            'da': '🇩🇰',
            'fi': '🇫🇮',
            'cs': '🇨🇿',
            'hu': '🇭🇺',
            'ro': '🇷🇴',
            'bg': '🇧🇬',
            'hr': '🇭🇷',
            'sk': '🇸🇰',
            'sl': '🇸🇮',
            'et': '🇪🇪',
            'lv': '🇱🇻',
            'lt': '🇱🇹',
            'ka': '🇬🇪',
            'uk': '🇺🇦',
            'be': '🇧🇾',
            'mk': '🇲🇰',
            'sq': '🇦🇱',
            'mt': '🇲🇹',
            'is': '🇮🇸',
            'ga': '🇮🇪',
            'cy': '🇬🇧',
            'eu': '🇪🇸',
            'ca': '🇪🇸',
            'gl': '🇪🇸'
          };
          return flagMap[code] || '🌍';
        }
        
        // Global functions for course selection
        window.selectCourse = function(langCode) {
          // Set the selected language in the dropdown
          const targetLangSelect = document.getElementById('target-lang');
          if (targetLangSelect) {
            targetLangSelect.value = langCode;
            // Trigger change event to apply the selection
            targetLangSelect.dispatchEvent(new Event('change'));
          }
          
          // Update course tab with selected language name
          updateCourseTabName(langCode);
          
          // Switch back to library tab
          if (typeof window.showTab === 'function') {
            window.showTab('library');
          }
        };
        
        // Function to update course tab name and icon
        function updateCourseTabName(langCode) {
          console.log(`🔄 updateCourseTabName called with langCode: ${langCode}`);
          const courseTabLabel = document.querySelector('.course-tab .tab-label');
          const courseTabIcon = document.querySelector('.course-tab .tab-icon');
          
          if (courseTabLabel) {
            // Get the localized name directly from the dropdown option
            const targetLangSelect = document.getElementById('target-lang');
            if (targetLangSelect) {
              const selectedOption = targetLangSelect.querySelector(`option[value="${langCode}"]`);
              if (selectedOption && selectedOption.textContent.trim()) {
                // Extract just the language name (remove the code part)
                const fullText = selectedOption.textContent.trim();
                console.log(`🔍 Full dropdown text for ${langCode}: "${fullText}"`);
                const match = fullText.match(/^(.+?)\s*\([A-Z]{2,3}\)$/);
                const courseName = match ? match[1].trim() : fullText;
                console.log(`📝 Setting course tab name to (from dropdown): "${courseName}"`);
                courseTabLabel.textContent = courseName;
                courseTabLabel.removeAttribute('data-i18n'); // Remove localization
              } else {
                console.log(`⚠️ No option found for langCode: ${langCode}, trying to wait for localization...`);
                // If dropdown is not localized yet, wait a bit and try again
                setTimeout(() => {
                  const retryOption = targetLangSelect.querySelector(`option[value="${langCode}"]`);
                  if (retryOption && retryOption.textContent.trim()) {
                    const fullText = retryOption.textContent.trim();
                    console.log(`🔍 Retry - Full dropdown text for ${langCode}: "${fullText}"`);
                    const match = fullText.match(/^(.+?)\s*\([A-Z]{2,3}\)$/);
                    const courseName = match ? match[1].trim() : fullText;
                    console.log(`📝 Retry - Setting course tab name to: "${courseName}"`);
                    courseTabLabel.textContent = courseName;
                    courseTabLabel.removeAttribute('data-i18n');
                  } else {
                    console.log(`⚠️ Still no localized option found, using fallback`);
                    // Fallback to course data
                    const courseName = getCourseNameByCode(langCode);
                    console.log(`📝 Setting course tab name to (fallback): ${courseName}`);
                    if (courseName) {
                      courseTabLabel.textContent = courseName;
                      courseTabLabel.removeAttribute('data-i18n');
                    }
                  }
                }, 500);
              }
            }
          }
          
          if (courseTabIcon) {
            // Get the flag for the language code
            const flag = getFlagForLanguage(langCode);
            console.log(`🏳️ Setting course tab icon to: ${flag}`);
            if (flag) {
              courseTabIcon.textContent = flag;
            }
          }
        }
        
        // Make updateCourseTabName globally available
        window.updateCourseTabName = updateCourseTabName;
        
        // Function to get course name by code
        function getCourseNameByCode(code) {
          // First try to get the name from the dropdown option (which should be localized)
          const targetLangSelect = document.getElementById('target-lang');
          if (targetLangSelect) {
            const selectedOption = targetLangSelect.querySelector(`option[value="${code}"]`);
            if (selectedOption && selectedOption.textContent.trim()) {
              // Extract just the language name (remove the code part)
              const fullText = selectedOption.textContent.trim();
              const match = fullText.match(/^(.+?)\s*\([A-Z]{2,3}\)$/);
              if (match) {
                console.log(`🌍 Course name from dropdown for ${code}:`, match[1].trim());
                return match[1].trim();
              } else {
                console.log(`🌍 Course name from dropdown (no code match) for ${code}:`, fullText);
                return fullText;
              }
            }
          }
          
          // Fallback to course data
          const courseData = window.courseData || {};
          const course = courseData[code];
          if (course && course.name) {
            console.log(`🌍 Course name from courseData for ${code}:`, course.name);
            return course.name;
          }
          
          console.log(`🌍 Fallback to uppercase code for ${code}`);
          return code.toUpperCase();
        }
        
        // Store course data globally for easy access
        window.courseData = {};
        
        // Function to initialize course tab with current selection using existing selectCourse function
        function initializeCourseTab() {
          const targetLangSelect = document.getElementById('target-lang');
          if (targetLangSelect && targetLangSelect.value) {
            // Use the existing updateCourseTabName function directly (from selectCourse)
            updateCourseTabName(targetLangSelect.value);
            return true; // Success
          }
          return false; // Failed, no selection
        }
        
        // Retry initialization with increasing delays
        function retryInitializeCourseTab(attempt = 0) {
          if (attempt > 20) return; // Give up after 20 attempts
          
          if (!initializeCourseTab()) {
            // Try again with exponential backoff
            const delay = Math.min(50 * Math.pow(1.3, attempt), 2000);
            setTimeout(() => retryInitializeCourseTab(attempt + 1), delay);
          }
        }
        
        // Also try to initialize when the dropdown is populated
        function onDropdownPopulated() {
          setTimeout(() => {
            const targetLangSelect = document.getElementById('target-lang');
            if (targetLangSelect && targetLangSelect.value) {
              // Use the existing updateCourseTabName function directly
              updateCourseTabName(targetLangSelect.value);
            }
          }, 100);
        }
        
        // Make onDropdownPopulated globally available
        window.onDropdownPopulated = onDropdownPopulated;
        
        // Initialize course tab when page loads
        document.addEventListener('DOMContentLoaded', function() {
          // Ensure the dropdown is populated first (reuse original logic)
          if (typeof window.ensureTargetLangOptions === 'function') {
            window.ensureTargetLangOptions();
          }
          
          // Start trying to initialize immediately
          retryInitializeCourseTab();
          
          // Add event listener for course selection changes
          const targetLangSelect = document.getElementById('target-lang');
          if (targetLangSelect) {
            targetLangSelect.addEventListener('change', function() {
              if (this.value) {
                updateCourseTabName(this.value);
              }
            });
          }
        });
        
        
        // Retry button functionality
        const retryCoursesBtn = document.getElementById('retry-courses');
        if (retryCoursesBtn) {
          retryCoursesBtn.addEventListener('click', loadCourseCards);
        }
        
        // Create custom levels button functionality
        const createCustomLevelsBtn = document.getElementById('create-custom-levels-btn');
        if (createCustomLevelsBtn) {
          createCustomLevelsBtn.addEventListener('click', function() {
            if (typeof window.showCreateCustomGroupModal === 'function') {
              window.showCreateCustomGroupModal();
            } else {
              console.error('showCreateCustomGroupModal function not available');
            }
          });
        }
        
        // Modal close functionality
        const modalCloseButtons = document.querySelectorAll('.modal-close');
        modalCloseButtons.forEach(function(closeBtn) {
          closeBtn.addEventListener('click', function() {
            const modal = closeBtn.closest('.modal');
            if (modal) {
              modal.style.display = 'none';
              document.body.style.overflow = 'auto';
            }
          });
        });
        
        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
          if (e.target.classList.contains('modal')) {
            e.target.style.display = 'none';
            document.body.style.overflow = 'auto';
          }
        });
        
        // Handle logout button in tooltip
        if (logoutBtnTooltip) {
          logoutBtnTooltip.addEventListener('click', function() {
            if (confirm('Möchten Sie sich wirklich abmelden?')) {
              if (window.authManager && typeof window.authManager.logout === 'function') {
                window.authManager.logout();
              } else if (typeof window.logout === 'function') {
                window.logout();
              } else if (typeof logout === 'function') {
                logout();
              }
            }
            logoutTooltip.style.display = 'none';
          });
        }
            
            // Settings button listeners
            const logoutBtn = document.getElementById('settings-logout');
            const deleteAccountBtn = document.getElementById('settings-delete-account');
            
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    if (confirm('Möchten Sie sich wirklich abmelden?')) {
                        logout();
                    }
                });
            }
            
            if (deleteAccountBtn) {
                deleteAccountBtn.addEventListener('click', function() {
                    if (confirm('Möchten Sie Ihr Konto wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden.')) {
                        // TODO: Implement account deletion
                        showNotification('Konto-Löschung noch nicht implementiert', 'warning');
                    }
                });
            }
            
            // Initialize native language from backend on app start
            async function initializeNativeLanguage() {
                try {
                    const nativeLang = await loadNativeLanguageFromBackend();
                    console.log('🌍 Initialized native language:', nativeLang);
                    
                    // Update the dropdown value in settings (with retry mechanism)
                    updateNativeLanguageDropdown(nativeLang);
                    
                    // Apply the native language if it's different from current
                    if (window.setLocale) {
                        window.setLocale(nativeLang);
                    }
                } catch (error) {
                    console.warn('⚠️ Failed to initialize native language from backend:', error);
                    // Fallback: still try to update dropdown with localStorage value
                    const fallbackLang = localStorage.getItem('siluma_native') || 'en';
                    updateNativeLanguageDropdown(fallbackLang);
                }
            }
            
            
            // Call initialization after a short delay to ensure auth is ready
            setTimeout(initializeNativeLanguage, 1000);
        });
    </script>

</body>

  <script src="/static/js/sounds.js"></script>
  <script src="/static/js/performance-optimizer.js"></script>
  <script src="/static/js/onboarding.js"></script>
  <script src="/static/js/ui/words-learning.js"></script>
  <script src="/static/js/ui/custom-level-groups.js"></script>
  <script type="module" src="/static/js/main.js"></script>
